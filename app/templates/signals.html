{% extends "base.html" %}

{% block title %}Signals - CryptoLens{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header & Filters -->
    <div class="flex items-center justify-between flex-wrap gap-4">
        <h1 class="text-2xl font-bold">Trade Signals</h1>

        <div class="flex items-center space-x-4">
            <a href="?status=pending" class="px-4 py-2 rounded text-sm {% if current_status == 'pending' %}bg-blue-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
                Pending
            </a>
            <a href="?status=notified" class="px-4 py-2 rounded text-sm {% if current_status == 'notified' %}bg-blue-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
                Notified
            </a>
            <a href="?status=" class="px-4 py-2 rounded text-sm {% if not current_status %}bg-blue-600{% else %}bg-gray-700 hover:bg-gray-600{% endif %}">
                All
            </a>
        </div>
    </div>

    <!-- Signals Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for signal in signals %}
        <div class="bg-card rounded-lg p-4 border-l-4 {% if signal.direction == 'long' %}border-green-500{% else %}border-red-500{% endif %}">
            <div class="flex items-center justify-between mb-3">
                <span class="font-bold text-lg">{{ signal.symbol_obj.symbol if signal.symbol_obj else 'Unknown' }}</span>
                <span class="{% if signal.direction == 'long' %}bullish{% else %}bearish{% endif %} font-bold text-lg">
                    {% if signal.direction == 'long' %}ðŸŸ¢ LONG{% else %}ðŸ”´ SHORT{% endif %}
                </span>
            </div>

            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-muted">Entry:</span>
                    <span class="font-mono">${{ '%.4f'|format(signal.entry_price) }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-muted">Stop Loss:</span>
                    <span class="font-mono text-red-400">${{ '%.4f'|format(signal.stop_loss) }}</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-muted">TP1 (1:1):</span>
                    <span class="font-mono text-green-400">${{ '%.4f'|format(signal.take_profit_1) }}</span>
                </div>
                {% if signal.take_profit_2 %}
                <div class="flex justify-between">
                    <span class="text-muted">TP2 (1:2):</span>
                    <span class="font-mono text-green-400">${{ '%.4f'|format(signal.take_profit_2) }}</span>
                </div>
                {% endif %}
                {% if signal.take_profit_3 %}
                <div class="flex justify-between">
                    <span class="text-muted">TP3 (1:{{ '%.0f'|format(signal.risk_reward) }}):</span>
                    <span class="font-mono text-green-400">${{ '%.4f'|format(signal.take_profit_3) }}</span>
                </div>
                {% endif %}
            </div>

            <div class="mt-4 pt-3 border-t border-gray-700 flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <span class="text-muted text-xs">Confluence:</span>
                    <span class="font-bold">{{ signal.confluence_score }}/6</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="px-2 py-1 rounded text-xs
                        {% if signal.status == 'notified' %}bg-green-900 text-green-200
                        {% elif signal.status == 'filled' %}bg-blue-900 text-blue-200
                        {% elif signal.status == 'stopped' %}bg-red-900 text-red-200
                        {% elif signal.status == 'tp_hit' %}bg-yellow-900 text-yellow-200
                        {% else %}bg-gray-700{% endif %}">
                        {{ signal.status }}
                    </span>
                </div>
            </div>

            <div class="mt-3 text-xs text-muted">
                {{ signal.created_at.strftime('%Y-%m-%d %H:%M') if signal.created_at else '' }}
            </div>
        </div>
        {% else %}
        <div class="col-span-full text-center py-12 text-muted">
            <p class="text-lg mb-2">No signals found</p>
            <p class="text-sm">Run a pattern scan to generate signals when confluence is detected.</p>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
