{% extends "base.html" %}

{% block title %}Documentation - CryptoLens Admin{% endblock %}

{% block extra_css %}
<style>
    .docs-container {
        display: flex;
        min-height: calc(100vh - 64px);
    }
    .docs-sidebar {
        width: 280px;
        min-width: 280px;
        background: var(--bg-card);
        border-right: 1px solid var(--border-color);
        padding: 1.5rem;
        overflow-y: auto;
        position: sticky;
        top: 64px;
        height: calc(100vh - 64px);
    }
    .docs-content {
        flex: 1;
        padding: 2rem 3rem;
        max-width: 900px;
        overflow-y: auto;
    }
    .docs-nav-section {
        margin-bottom: 1.5rem;
    }
    .docs-nav-title {
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
        letter-spacing: 0.05em;
    }
    .docs-nav-link {
        display: block;
        padding: 0.4rem 0.75rem;
        margin: 0.1rem 0;
        border-radius: 0.375rem;
        color: var(--text-muted);
        text-decoration: none;
        font-size: 0.875rem;
        transition: all 0.15s;
    }
    .docs-nav-link:hover {
        background: var(--bg-darker);
        color: var(--text-primary);
    }
    .docs-nav-link.active {
        background: #3b82f6;
        color: white;
    }
    .docs-section {
        display: none;
        animation: fadeIn 0.3s ease;
    }
    .docs-section.active {
        display: block;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .docs-h1 {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--border-color);
    }
    .docs-h2 {
        font-size: 1.5rem;
        font-weight: 600;
        margin: 2rem 0 1rem 0;
        color: #60a5fa;
    }
    .docs-h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin: 1.5rem 0 0.75rem 0;
    }
    .docs-p {
        margin-bottom: 1rem;
        line-height: 1.7;
        color: var(--text-secondary);
    }
    .docs-table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
        font-size: 0.875rem;
    }
    .docs-table th, .docs-table td {
        padding: 0.75rem 1rem;
        text-align: left;
        border: 1px solid var(--border-color);
    }
    .docs-table th {
        background: var(--bg-darker);
        font-weight: 600;
    }
    .docs-table tr:hover {
        background: var(--bg-darker);
    }
    .docs-code {
        background: var(--bg-darker);
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
        font-family: monospace;
        font-size: 0.875rem;
        color: #f472b6;
    }
    .docs-codeblock {
        background: var(--bg-darker);
        padding: 1rem;
        border-radius: 0.5rem;
        margin: 1rem 0;
        overflow-x: auto;
        font-family: monospace;
        font-size: 0.875rem;
        line-height: 1.5;
    }
    .docs-list {
        margin: 1rem 0 1rem 1.5rem;
        line-height: 1.8;
    }
    .docs-list li {
        margin: 0.25rem 0;
    }
    .docs-alert {
        padding: 1rem 1.25rem;
        border-radius: 0.5rem;
        margin: 1rem 0;
    }
    .docs-alert-info {
        background: rgba(59, 130, 246, 0.1);
        border-left: 4px solid #3b82f6;
    }
    .docs-alert-warning {
        background: rgba(245, 158, 11, 0.1);
        border-left: 4px solid #f59e0b;
    }
    .docs-alert-success {
        background: rgba(34, 197, 94, 0.1);
        border-left: 4px solid #22c55e;
    }
    .docs-badge {
        display: inline-block;
        padding: 0.2rem 0.5rem;
        border-radius: 0.25rem;
        font-size: 0.75rem;
        font-weight: 600;
    }
    .docs-badge-green { background: #22c55e; color: white; }
    .docs-badge-red { background: #ef4444; color: white; }
    .docs-badge-blue { background: #3b82f6; color: white; }
    .docs-badge-yellow { background: #f59e0b; color: black; }
    .docs-badge-purple { background: #a855f7; color: white; }
    .docs-badge-cyan { background: #06b6d4; color: white; }
    .docs-badge-gray { background: #6b7280; color: white; }
    .docs-badge-pink { background: #ec4899; color: white; }
    .docs-badge-violet { background: #8b5cf6; color: white; }
    .docs-badge-emerald { background: #10b981; color: white; }
    .docs-badge-orange { background: #f97316; color: white; }
    .docs-badge-teal { background: #14b8a6; color: white; }
    .docs-badge-indigo { background: #6366f1; color: white; }
    .docs-badge-darkred { background: #dc2626; color: white; }
    .pattern-diagram {
        background: var(--bg-darker);
        padding: 1.5rem;
        border-radius: 0.5rem;
        font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace;
        white-space: pre;
        margin: 1rem 0;
        overflow-x: auto;
        line-height: 1.4;
    }
    .docs-diagram {
        background: var(--bg-darker);
        padding: 1.5rem;
        border-radius: 0.5rem;
        font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', 'Source Code Pro', 'Menlo', 'Consolas', monospace;
        white-space: pre;
        margin: 1rem 0;
        overflow-x: auto;
        line-height: 1.3;
        font-size: 0.8rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="docs-container" x-data="{ activeSection: '{{ active_section }}' }">
    <!-- Sidebar Navigation -->
    <aside class="docs-sidebar">
        <div class="text-xl font-bold mb-6 text-blue-400">Documentation</div>

        <nav>
            <!-- Getting Started -->
            <div class="docs-nav-section">
                <div class="docs-nav-title">Getting Started</div>
                <a href="#" @click.prevent="activeSection = 'overview'" class="docs-nav-link" :class="{ active: activeSection === 'overview' }">Overview</a>
                <a href="#" @click.prevent="activeSection = 'architecture'" class="docs-nav-link" :class="{ active: activeSection === 'architecture' }">Architecture</a>
            </div>

            <!-- Trading Concepts -->
            <div class="docs-nav-section">
                <div class="docs-nav-title">Trading Concepts</div>
                <a href="#" @click.prevent="activeSection = 'patterns'" class="docs-nav-link" :class="{ active: activeSection === 'patterns' }">Pattern Types</a>
                <a href="#" @click.prevent="activeSection = 'signals'" class="docs-nav-link" :class="{ active: activeSection === 'signals' }">Signals & Confluence</a>
                <a href="#" @click.prevent="activeSection = 'backtest'" class="docs-nav-link" :class="{ active: activeSection === 'backtest' }">Backtesting</a>
            </div>

            <!-- Features -->
            <div class="docs-nav-section">
                <div class="docs-nav-title">Features</div>
                <a href="#" @click.prevent="activeSection = 'dashboard'" class="docs-nav-link" :class="{ active: activeSection === 'dashboard' }">Dashboard & Navigation</a>
                <a href="#" @click.prevent="activeSection = 'portfolio'" class="docs-nav-link" :class="{ active: activeSection === 'portfolio' }">Portfolio & Trading</a>
                <a href="#" @click.prevent="activeSection = 'profile'" class="docs-nav-link" :class="{ active: activeSection === 'profile' }">Profile Settings</a>
                <a href="#" @click.prevent="activeSection = 'notifications'" class="docs-nav-link" :class="{ active: activeSection === 'notifications' }">Notifications</a>
                <a href="#" @click.prevent="activeSection = 'tiers'" class="docs-nav-link" :class="{ active: activeSection === 'tiers' }">Subscription Tiers</a>
            </div>

            <!-- Backend -->
            <div class="docs-nav-section">
                <div class="docs-nav-title">Backend</div>
                <a href="#" @click.prevent="activeSection = 'scripts'" class="docs-nav-link" :class="{ active: activeSection === 'scripts' }">Scripts & Cron Jobs</a>
                <a href="#" @click.prevent="activeSection = 'services'" class="docs-nav-link" :class="{ active: activeSection === 'services' }">Services Architecture</a>
                <a href="#" @click.prevent="activeSection = 'models'" class="docs-nav-link" :class="{ active: activeSection === 'models' }">Database Models</a>
                <a href="#" @click.prevent="activeSection = 'retention'" class="docs-nav-link" :class="{ active: activeSection === 'retention' }">Data Retention</a>
            </div>

            <!-- Technical -->
            <div class="docs-nav-section">
                <div class="docs-nav-title">Technical Reference</div>
                <a href="#" @click.prevent="activeSection = 'testing'" class="docs-nav-link" :class="{ active: activeSection === 'testing' }">Testing</a>
                <a href="#" @click.prevent="activeSection = 'logs'" class="docs-nav-link" :class="{ active: activeSection === 'logs' }">Logging System</a>
                <a href="#" @click.prevent="activeSection = 'api'" class="docs-nav-link" :class="{ active: activeSection === 'api' }">API Reference</a>
                <a href="#" @click.prevent="activeSection = 'config'" class="docs-nav-link" :class="{ active: activeSection === 'config' }">Configuration</a>
                <a href="#" @click.prevent="activeSection = 'deployment'" class="docs-nav-link" :class="{ active: activeSection === 'deployment' }">Deployment</a>
            </div>

            <!-- Admin -->
            <div class="docs-nav-section">
                <div class="docs-nav-title">Administration</div>
                <a href="#" @click.prevent="activeSection = 'admin'" class="docs-nav-link" :class="{ active: activeSection === 'admin' }">Admin Panel</a>
                <a href="#" @click.prevent="activeSection = 'security'" class="docs-nav-link" :class="{ active: activeSection === 'security' }">Security</a>
            </div>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="docs-content">

        <!-- ==================== OVERVIEW ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'overview' }">
            <h1 class="docs-h1">CryptoLens Overview</h1>

            <p class="docs-p">
                CryptoLens is a <strong>Smart Money Concepts (SMC) pattern detection platform</strong> for cryptocurrency trading.
                It automatically identifies institutional trading patterns across multiple timeframes and sends push notifications
                when high-probability setups occur.
            </p>

            <h2 class="docs-h2">Key Features</h2>
            <ul class="docs-list">
                <li><strong>Pattern Detection</strong> - Fair Value Gaps, Order Blocks, and Liquidity Sweeps</li>
                <li><strong>Multi-Timeframe Analysis</strong> - 1m, 5m, 15m, 1h, 4h, 1d timeframes</li>
                <li><strong>Confluence Signals</strong> - Higher reliability when patterns align across timeframes</li>
                <li><strong>Push Notifications</strong> - Real-time alerts via NTFY.sh</li>
                <li><strong>Portfolio Management</strong> - Track trades and journal entries</li>
                <li><strong>Backtesting</strong> - Test strategies on historical data</li>
                <li><strong>3-Tier Subscriptions</strong> - Free, Pro, and Premium plans</li>
            </ul>

            <h2 class="docs-h2">Technology Stack</h2>
            <table class="docs-table">
                <tr><th>Component</th><th>Technology</th></tr>
                <tr><td>Backend</td><td>Python 3.9+, Flask 3.0</td></tr>
                <tr><td>Database</td><td>MySQL 8.0+ (dev and prod)</td></tr>
                <tr><td>Exchange Data</td><td>CCXT (Binance)</td></tr>
                <tr><td>Notifications</td><td>NTFY.sh</td></tr>
                <tr><td>Payments</td><td>LemonSqueezy (fiat), NOWPayments (crypto)</td></tr>
                <tr><td>Frontend</td><td>Jinja2, Alpine.js, TailwindCSS</td></tr>
            </table>

            <h2 class="docs-h2">Version History</h2>
            <p class="docs-p">Current version: <span class="docs-badge docs-badge-blue">v2.1.0</span></p>
            <p class="docs-p">Status: <span class="docs-badge docs-badge-green">Production Ready</span></p>
        </section>

        <!-- ==================== ARCHITECTURE ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'architecture' }">
            <h1 class="docs-h1">Architecture</h1>

            <h2 class="docs-h2">System Components</h2>
            <div class="docs-diagram">+----------------------------------------------------------+
|                       CryptoLens                         |
+----------------------------------------------------------+
|  +----------+  +----------+  +----------+  +----------+  |
|  |  Flask   |  |  CCXT    |  |  NTFY    |  | Payments |  |
|  |  Web App |  |  Data    |  |  Push    |  | Gateway  |  |
|  +----+-----+  +----+-----+  +----+-----+  +----+-----+  |
|       |             |             |             |         |
|  +----v-------------v-------------v-------------v----+   |
|  |              Service Layer                        |   |
|  |  +---------+ +---------+ +---------+ +---------+  |   |
|  |  | Pattern | | Signal  | | Notif   | | Payment |  |   |
|  |  | Detect  | | Generate| | Service | | Service |  |   |
|  |  +---------+ +---------+ +---------+ +---------+  |   |
|  +------------------------+--------------------------|   |
|                           |                              |
|  +------------------------v--------------------------+   |
|  |              SQLAlchemy ORM                       |   |
|  +------------------------+--------------------------+   |
|                           |                              |
|  +------------------------v--------------------------+   |
|  |                 MySQL Database                     |   |
|  +---------------------------------------------------+   |
+----------------------------------------------------------+</div>

            <h2 class="docs-h2">Data Flow</h2>
            <ol class="docs-list">
                <li><strong>Fetch</strong> - CCXT fetches candle data from Binance every minute</li>
                <li><strong>Aggregate</strong> - Raw 1m candles aggregated to higher timeframes</li>
                <li><strong>Detect</strong> - Pattern detectors scan for FVG, OB, and Sweep patterns</li>
                <li><strong>Signal</strong> - Confluence calculator generates trade signals</li>
                <li><strong>Notify</strong> - NTFY sends push notifications to subscribers</li>
                <li><strong>Expire</strong> - Old patterns expired based on timeframe rules</li>
            </ol>

            <h2 class="docs-h2">Directory Structure</h2>
            <div class="docs-diagram">cryptolens/
|-- app/
|   |-- routes/          # Web routes (api, auth, dashboard, etc.)
|   |-- services/        # Business logic
|   |   +-- patterns/    # FVG, OB, Sweep detectors
|   |-- models/          # SQLAlchemy models
|   |-- templates/       # Jinja2 HTML templates
|   |-- static/          # CSS, JS, images
|   +-- jobs/            # Background job definitions
|-- scripts/
|   |-- fetch.py         # Main data pipeline (cron)
|   |-- compute_stats.py # Stats caching (cron)
|   +-- db_health.py     # Data integrity check (cron)
|-- tests/               # Test suite (607 tests)
+-- run.py               # Development server</div>

            <h2 class="docs-h2">Background Jobs (Cron)</h2>
            <table class="docs-table">
                <tr><th>Job</th><th>Frequency</th><th>Purpose</th></tr>
                <tr><td>fetch.py</td><td>Every 1 min</td><td>Fetch candles, detect patterns, send notifications</td></tr>
                <tr><td>compute_stats.py</td><td>Every 5 min</td><td>Cache statistics for fast page loads</td></tr>
                <tr><td>db_health.py</td><td>Daily 3 AM</td><td>Verify data integrity, clean old data</td></tr>
            </table>
        </section>

        <!-- ==================== PATTERNS ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'patterns' }">
            <h1 class="docs-h1">Trading Pattern Types</h1>

            <p class="docs-p">
                CryptoLens detects three Smart Money Concepts (SMC) patterns that indicate institutional activity.
                These patterns represent areas where large players have placed orders or hunted liquidity.
            </p>

            <!-- FVG -->
            <h2 class="docs-h2">Fair Value Gap (FVG) <span class="docs-badge docs-badge-green">F</span></h2>

            <p class="docs-p">
                A <strong>Fair Value Gap</strong> is a 3-candle pattern where aggressive buying or selling creates a gap
                between candle 1's wick and candle 3's wick. This gap represents unfilled orders where price moved too fast.
            </p>

            <h3 class="docs-h3">Detection Logic</h3>
            <ul class="docs-list">
                <li><strong>Bullish FVG</strong>: Candle 1 high &lt; Candle 3 low (gap up)</li>
                <li><strong>Bearish FVG</strong>: Candle 1 low &gt; Candle 3 high (gap down)</li>
                <li>Minimum gap size: Configurable (default 0.1% of price)</li>
            </ul>

            <div class="docs-diagram">Bullish FVG:
                    +-----+
                    |     | &lt;- Candle 3
              +-----+     |
    ==========|=====|=====|======  &lt;- FVG Zone (entry area)
              |     +-----+
        +-----+ &lt;- Candle 1
        |     |
        +-----+

Bearish FVG:
        +-----+
        |     | &lt;- Candle 1
        |     +-----+
    ====|=====|=====|============  &lt;- FVG Zone (entry area)
        +-----+     |
                    |     | &lt;- Candle 3
                    +-----+</div>

            <h3 class="docs-h3">How to Trade</h3>
            <ol class="docs-list">
                <li>Wait for price to retrace back into the FVG zone</li>
                <li><strong>Entry</strong>: At the zone edge (conservative) or midpoint (aggressive)</li>
                <li><strong>Stop Loss</strong>: Beyond the opposite edge of the zone + buffer</li>
                <li><strong>Take Profit</strong>: 1:2 or 1:3 risk-reward ratio</li>
            </ol>

            <div class="docs-alert docs-alert-info">
                <strong>Pro Tip:</strong> FVGs on higher timeframes (4h, 1d) are more significant than lower timeframes.
            </div>

            <!-- Order Block -->
            <h2 class="docs-h2">Order Block (OB) <span class="docs-badge docs-badge-purple">O</span></h2>

            <p class="docs-p">
                An <strong>Order Block</strong> is the last opposing candle before a strong impulsive move.
                It represents where institutions placed large orders that caused the subsequent move.
            </p>

            <h3 class="docs-h3">Detection Logic</h3>
            <ul class="docs-list">
                <li><strong>Bullish OB</strong>: Last red (bearish) candle before a strong green impulse</li>
                <li><strong>Bearish OB</strong>: Last green (bullish) candle before a strong red impulse</li>
                <li>Impulse must be &gt; 1.5x average body size</li>
                <li>Impulse should break recent structure (swing high/low)</li>
            </ul>

            <div class="docs-diagram">Bullish Order Block:
        +-----+
        | ^^^ | &lt;- Strong impulse up
        | ^^^ |
   =====|=====|=====  &lt;- Order Block zone
        | v   | &lt;- Last red candle (OB)
        +-----+

Bearish Order Block:
        +-----+
        | ^   | &lt;- Last green candle (OB)
   =====|=====|=====  &lt;- Order Block zone
        | vvv |
        | vvv | &lt;- Strong impulse down
        +-----+</div>

            <h3 class="docs-h3">How to Trade</h3>
            <ol class="docs-list">
                <li>Mark the order block candle's body (open to close)</li>
                <li>Wait for price to return to this zone</li>
                <li><strong>Entry</strong>: Within the OB body</li>
                <li><strong>Stop Loss</strong>: Beyond the OB wick</li>
                <li><strong>Take Profit</strong>: Previous swing high/low or 1:2 RR</li>
            </ol>

            <!-- Liquidity Sweep -->
            <h2 class="docs-h2">Liquidity Sweep (Sweep) <span class="docs-badge docs-badge-yellow">S</span></h2>

            <p class="docs-p">
                A <strong>Liquidity Sweep</strong> occurs when price takes out obvious highs/lows (where stop losses cluster)
                before reversing. Institutions hunt these liquidity pools to fill large orders.
            </p>

            <h3 class="docs-h3">Detection Logic</h3>
            <ul class="docs-list">
                <li>Identify swing highs/lows (using lookback period)</li>
                <li><strong>Bullish Sweep</strong>: Price wicks below swing low, closes back above</li>
                <li><strong>Bearish Sweep</strong>: Price wicks above swing high, closes back below</li>
                <li>The sweep should be followed by reversal momentum</li>
            </ul>

            <div class="docs-diagram">Bearish Liquidity Sweep:
   ------------ Previous High (liquidity)
        |
   =====|===== &lt;- Sweep wick (takes out stops)
        |
   -----+-----  &lt;- Close back inside
        |
        v
     Reversal</div>

            <h3 class="docs-h3">How to Trade</h3>
            <ol class="docs-list">
                <li>Identify obvious swing highs/lows where stops cluster</li>
                <li>Wait for a sweep (wick beyond, close inside)</li>
                <li><strong>Entry</strong>: After the sweep candle closes</li>
                <li><strong>Stop Loss</strong>: Beyond the sweep wick</li>
                <li><strong>Take Profit</strong>: Opposite side of the range</li>
            </ol>

            <!-- Pattern Expiry -->
            <h2 class="docs-h2">Pattern Expiry Rules</h2>
            <p class="docs-p">Patterns automatically expire based on their timeframe significance:</p>

            <table class="docs-table">
                <tr><th>Timeframe</th><th>Expiry Time</th><th>Candles Loaded</th></tr>
                <tr><td>1m</td><td>4 hours</td><td>500</td></tr>
                <tr><td>5m</td><td>12 hours</td><td>400</td></tr>
                <tr><td>15m</td><td>24 hours</td><td>300</td></tr>
                <tr><td>1h</td><td>3 days</td><td>250</td></tr>
                <tr><td>4h</td><td>7 days</td><td>200</td></tr>
                <tr><td>1d</td><td>14 days</td><td>150</td></tr>
            </table>
        </section>

        <!-- ==================== SIGNALS ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'signals' }">
            <h1 class="docs-h1">Signals & Confluence</h1>

            <h2 class="docs-h2">What is Confluence?</h2>
            <p class="docs-p">
                <strong>Confluence</strong> occurs when multiple timeframes show patterns in the same direction.
                Higher confluence scores indicate more reliable trade setups.
            </p>

            <h2 class="docs-h2">Confluence Scoring</h2>
            <table class="docs-table">
                <tr><th>Score</th><th>Meaning</th><th>Reliability</th></tr>
                <tr><td>2 TFs</td><td>Moderate signal</td><td>Standard</td></tr>
                <tr><td>3 TFs</td><td>Strong signal</td><td>High</td></tr>
                <tr><td>4+ TFs</td><td>Very strong signal</td><td>Very High</td></tr>
                <tr><td>HTF + LTF</td><td>Multi-timeframe alignment</td><td>Highest</td></tr>
            </table>

            <h2 class="docs-h2">Signal Generation</h2>
            <p class="docs-p">Signals are generated when:</p>
            <ol class="docs-list">
                <li>At least 2 timeframes show patterns in the same direction</li>
                <li>Patterns are from the same symbol</li>
                <li>Confluence score meets the user's minimum threshold</li>
            </ol>

            <h2 class="docs-h2">Signal Contents</h2>
            <p class="docs-p">Each signal includes:</p>
            <ul class="docs-list">
                <li><strong>Symbol</strong> - Trading pair (e.g., BTC/USDT)</li>
                <li><strong>Direction</strong> - LONG or SHORT</li>
                <li><strong>Entry Price</strong> - Suggested entry level</li>
                <li><strong>Stop Loss</strong> - Risk management level</li>
                <li><strong>Take Profit 1 & 2</strong> - Profit targets</li>
                <li><strong>Confluence Score</strong> - Number of aligned timeframes</li>
                <li><strong>Timeframes</strong> - Which TFs are aligned</li>
            </ul>

            <div class="docs-alert docs-alert-warning">
                <strong>Important:</strong> Signals are for informational purposes only. Always do your own analysis and manage risk appropriately.
            </div>
        </section>

        <!-- ==================== BACKTEST ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'backtest' }">
            <h1 class="docs-h1">Backtesting</h1>

            <p class="docs-p">
                The backtesting module allows you to test pattern-based strategies on historical data.
                This helps evaluate strategy performance before trading with real capital.
            </p>

            <h2 class="docs-h2">Backtest Parameters</h2>
            <table class="docs-table">
                <tr><th>Parameter</th><th>Description</th></tr>
                <tr><td>Symbol</td><td>Trading pair to test</td></tr>
                <tr><td>Timeframe</td><td>Chart timeframe</td></tr>
                <tr><td>Start Date</td><td>Backtest start date</td></tr>
                <tr><td>End Date</td><td>Backtest end date</td></tr>
                <tr><td>Pattern Type</td><td>FVG, Order Block, or Liquidity Sweep</td></tr>
                <tr><td>R:R Target</td><td>Risk-to-reward ratio (e.g., 2.0 = 1:2)</td></tr>
            </table>

            <h2 class="docs-h2">Backtest Results</h2>
            <ul class="docs-list">
                <li><strong>Total Trades</strong> - Number of trades taken</li>
                <li><strong>Win Rate</strong> - Percentage of winning trades</li>
                <li><strong>Average R:R</strong> - Average risk-reward achieved</li>
                <li><strong>Total Profit %</strong> - Cumulative profit percentage</li>
                <li><strong>Max Drawdown</strong> - Largest peak-to-trough decline</li>
                <li><strong>Trade List</strong> - Individual trade details</li>
            </ul>

            <h2 class="docs-h2">Trade Simulation Logic</h2>
            <ol class="docs-list">
                <li>Pattern detected at candle N</li>
                <li>Wait for price to enter the zone (entry trigger)</li>
                <li>If entry triggered, monitor for SL or TP hit</li>
                <li>Record result: Win (TP hit), Loss (SL hit), or No Fill</li>
            </ol>

            <div class="docs-alert docs-alert-info">
                <strong>Note:</strong> Backtesting is available for Premium tier users only.
            </div>
        </section>

        <!-- ==================== DASHBOARD ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'dashboard' }">
            <h1 class="docs-h1">Dashboard</h1>

            <h2 class="docs-h2">Navigation Structure</h2>
            <p class="docs-p">
                The main navigation bar provides quick access to all features:
            </p>
            <div class="docs-codeblock">Dashboard | Patterns | Portfolio | Analytics | Backtest | API | Admin | [ðŸ‘¤]</div>
            <ul class="docs-list">
                <li><strong>Dashboard</strong> - Pattern Matrix overview</li>
                <li><strong>Patterns</strong> - Active Patterns + Signals (tabbed view)</li>
                <li><strong>Portfolio</strong> - Trade tracking and journaling</li>
                <li><strong>Analytics</strong> - Performance metrics</li>
                <li><strong>Backtest</strong> - Strategy testing (Premium)</li>
                <li><strong>API</strong> - Interactive API documentation</li>
                <li><strong>Admin</strong> - Admin panel (admin-only, yellow text)</li>
                <li><strong>[ðŸ‘¤]</strong> - Profile page (click avatar)</li>
            </ul>

            <h2 class="docs-h2">Pattern Matrix</h2>
            <p class="docs-p">
                The Pattern Matrix shows all active patterns across symbols and timeframes in a grid format.
            </p>

            <h3 class="docs-h3">Matrix Legend</h3>
            <table class="docs-table">
                <tr><th>Indicator</th><th>Meaning</th></tr>
                <tr><td><span class="docs-badge docs-badge-green">F</span></td><td>Fair Value Gap (bullish)</td></tr>
                <tr><td><span class="docs-badge docs-badge-red">F</span></td><td>Fair Value Gap (bearish)</td></tr>
                <tr><td><span class="docs-badge docs-badge-green">O</span></td><td>Order Block (bullish)</td></tr>
                <tr><td><span class="docs-badge docs-badge-red">O</span></td><td>Order Block (bearish)</td></tr>
                <tr><td><span class="docs-badge docs-badge-green">S</span></td><td>Liquidity Sweep (bullish)</td></tr>
                <tr><td><span class="docs-badge docs-badge-red">S</span></td><td>Liquidity Sweep (bearish)</td></tr>
                <tr><td>Yellow border</td><td>Multiple patterns in cell</td></tr>
            </table>

            <h3 class="docs-h3">Pattern Tabs</h3>
            <ul class="docs-list">
                <li><strong>All Patterns</strong> - Show all pattern types</li>
                <li><strong>Fair Value Gap (F)</strong> - Filter to FVG only</li>
                <li><strong>Order Block (O)</strong> - Filter to OB only</li>
                <li><strong>Liquidity Sweep (S)</strong> - Filter to Sweep only</li>
            </ul>

            <h2 class="docs-h2">Patterns Page</h2>
            <p class="docs-p">The Patterns page combines patterns and signals in a tabbed interface:</p>
            <ul class="docs-list">
                <li><strong>Active Patterns tab</strong> - TradingView charts with pattern zones, timeframe selector</li>
                <li><strong>Signals tab</strong> - Trade signals with entry/SL/TP, direction filter, confluence scores</li>
            </ul>
        </section>

        <!-- ==================== PORTFOLIO ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'portfolio' }">
            <h1 class="docs-h1">Portfolio & Trading</h1>

            <h2 class="docs-h2">Portfolios</h2>
            <p class="docs-p">
                Create multiple portfolios to track different strategies or accounts.
                Each portfolio has its own balance, trades, and statistics.
            </p>

            <h3 class="docs-h3">Portfolio Limits by Tier</h3>
            <table class="docs-table">
                <tr><th>Tier</th><th>Portfolios</th><th>Trades/Day</th></tr>
                <tr><td>Free</td><td>-</td><td>-</td></tr>
                <tr><td>Pro</td><td>1</td><td>5</td></tr>
                <tr><td>Premium</td><td>Unlimited</td><td>Unlimited</td></tr>
            </table>

            <h2 class="docs-h2">Trade Management</h2>
            <p class="docs-p">Track trades from entry to exit with full journaling support.</p>

            <h3 class="docs-h3">Trade Status Flow</h3>
            <div class="docs-diagram">Pending --&gt; Open --&gt; Closed
    |
    +------&gt; Cancelled</div>

            <h3 class="docs-h3">Trade Fields</h3>
            <ul class="docs-list">
                <li><strong>Symbol</strong> - Trading pair</li>
                <li><strong>Direction</strong> - Long or Short</li>
                <li><strong>Entry Price/Quantity</strong> - Position entry</li>
                <li><strong>Stop Loss / Take Profit</strong> - Risk management levels</li>
                <li><strong>Risk %</strong> - Percentage of portfolio risked</li>
                <li><strong>Setup Notes</strong> - Pre-trade analysis</li>
                <li><strong>Lessons Learned</strong> - Post-trade review</li>
            </ul>

            <h2 class="docs-h2">Journal Entries</h2>
            <p class="docs-p">Add journal entries to track your thinking and emotions during trades:</p>
            <ul class="docs-list">
                <li><strong>Pre-Trade</strong> - Analysis and setup reasoning</li>
                <li><strong>During Trade</strong> - Real-time thoughts and adjustments</li>
                <li><strong>Post-Trade</strong> - Review and lessons learned</li>
                <li><strong>Mood Tracking</strong> - Confident, Neutral, Fearful, Greedy, FOMO, Revenge</li>
            </ul>
        </section>

        <!-- ==================== PROFILE ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'profile' }">
            <h1 class="docs-h1">Profile Settings</h1>

            <p class="docs-p">
                Access your profile by clicking on the avatar icon in the top-right corner of the navigation bar.
                The Profile page is organized into tabs for easy navigation.
            </p>

            <h2 class="docs-h2">Profile Tabs</h2>

            <h3 class="docs-h3">Account</h3>
            <ul class="docs-list">
                <li><strong>Username</strong> - Display name (read-only)</li>
                <li><strong>Email</strong> - Account email address</li>
                <li><strong>Timezone</strong> - Select your preferred timezone for displaying times</li>
                <li><strong>Member Since</strong> - Account creation date</li>
            </ul>

            <h3 class="docs-h3">Security</h3>
            <ul class="docs-list">
                <li><strong>Change Password</strong> - Update your account password</li>
                <li><strong>Two-Factor Authentication</strong> - Enable/disable TOTP-based 2FA</li>
                <li><strong>Backup Codes</strong> - Generate recovery codes for 2FA</li>
            </ul>

            <h3 class="docs-h3">Notifications</h3>
            <ul class="docs-list">
                <li><strong>NTFY Topic</strong> - Your unique notification topic</li>
                <li><strong>Direction Filter</strong> - Bullish only, Bearish only, or Both</li>
                <li><strong>Min Confluence</strong> - Minimum timeframes required</li>
                <li><strong>Quiet Hours</strong> - Suppress notifications during sleep</li>
                <li><strong>Test Button</strong> - Send a test notification</li>
            </ul>

            <h3 class="docs-h3">Trading</h3>
            <ul class="docs-list">
                <li><strong>Default Risk %</strong> - Default position sizing</li>
                <li><strong>Risk:Reward Ratio</strong> - Default R:R for calculations</li>
                <li><strong>Default Symbol</strong> - Preferred trading pair</li>
            </ul>

            <h3 class="docs-h3">Subscription</h3>
            <ul class="docs-list">
                <li><strong>Current Plan</strong> - Your subscription tier</li>
                <li><strong>Plan Comparison</strong> - Feature comparison table</li>
                <li><strong>Upgrade Options</strong> - Links to upgrade to Pro or Premium</li>
            </ul>

            <div class="docs-alert docs-alert-info">
                <strong>Logout:</strong> The logout button is located in the top-right corner of the Profile page.
            </div>
        </section>

        <!-- ==================== NOTIFICATIONS ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'notifications' }">
            <h1 class="docs-h1">Notifications</h1>

            <h2 class="docs-h2">NTFY.sh Integration</h2>
            <p class="docs-p">
                CryptoLens uses <a href="https://ntfy.sh" target="_blank" class="text-blue-400">NTFY.sh</a> for push notifications.
                Each user gets a unique topic for private notifications.
            </p>

            <h3 class="docs-h3">Setup Steps</h3>
            <ol class="docs-list">
                <li>Register and verify your email</li>
                <li>Install the NTFY app on your phone (iOS/Android)</li>
                <li>Go to Profile > Notifications tab to see your unique topic</li>
                <li>Subscribe to your topic in the NTFY app</li>
                <li>Test notifications from the Notifications tab</li>
            </ol>

            <h2 class="docs-h2">Notification Limits by Tier</h2>
            <table class="docs-table">
                <tr><th>Tier</th><th>Daily Limit</th><th>Delay</th></tr>
                <tr><td>Free</td><td>1/day</td><td>10 min delay</td></tr>
                <tr><td>Pro</td><td>20/day</td><td>Real-time</td></tr>
                <tr><td>Premium</td><td>Unlimited</td><td>Real-time</td></tr>
            </table>

            <h2 class="docs-h2">Notification Preferences</h2>
            <ul class="docs-list">
                <li><strong>Direction Filter</strong> - Bullish only, Bearish only, or Both</li>
                <li><strong>Min Confluence</strong> - Minimum timeframes aligned</li>
                <li><strong>Quiet Hours</strong> - Suppress notifications during sleep</li>
                <li><strong>Symbol Mute</strong> - Mute specific symbols (Premium only)</li>
            </ul>

            <h2 class="docs-h2">Admin Broadcasts</h2>
            <p class="docs-p">Admins can send broadcast notifications to users:</p>
            <ul class="docs-list">
                <li><strong>Target Audience</strong> - All users, specific tier, or verified only</li>
                <li><strong>Templates</strong> - Save and reuse notification templates</li>
                <li><strong>Scheduling</strong> - Schedule notifications for future delivery</li>
            </ul>
        </section>

        <!-- ==================== TIERS ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'tiers' }">
            <h1 class="docs-h1">Subscription Tiers</h1>

            <h2 class="docs-h2">Feature Comparison</h2>
            <table class="docs-table">
                <tr><th>Feature</th><th>Free</th><th>Pro</th><th>Premium</th></tr>
                <tr><td>Symbols</td><td>BTC/USDT only</td><td>5 symbols</td><td>Unlimited</td></tr>
                <tr><td>Pattern Types</td><td>FVG only</td><td>All 3</td><td>All 3</td></tr>
                <tr><td>Patterns Page</td><td>-</td><td>Last 100</td><td>Full history</td></tr>
                <tr><td>Signals Page</td><td>-</td><td>Last 50</td><td>Full history</td></tr>
                <tr><td>Portfolio</td><td>-</td><td>1 portfolio, 5tx/day</td><td>Unlimited</td></tr>
                <tr><td>Backtest</td><td>-</td><td>-</td><td>Full access</td></tr>
                <tr><td>Analytics</td><td>-</td><td>Full</td><td>Full</td></tr>
                <tr><td>Notifications</td><td>1/day, 10min delay</td><td>20/day</td><td>Unlimited</td></tr>
                <tr><td>API Access</td><td>-</td><td>-</td><td>Full</td></tr>
            </table>

            <h2 class="docs-h2">Pattern Access by Tier</h2>
            <table class="docs-table">
                <tr><th>Pattern</th><th>Free</th><th>Pro</th><th>Premium</th></tr>
                <tr><td>Fair Value Gap (F)</td><td>&#10004;</td><td>&#10004;</td><td>&#10004;</td></tr>
                <tr><td>Order Block (O)</td><td>-</td><td>&#10004;</td><td>&#10004;</td></tr>
                <tr><td>Liquidity Sweep (S)</td><td>-</td><td>&#10004;</td><td>&#10004;</td></tr>
            </table>

            <h2 class="docs-h2">Payment Methods</h2>
            <ul class="docs-list">
                <li><strong>LemonSqueezy</strong> - Credit/debit cards</li>
                <li><strong>NOWPayments</strong> - BTC, ETH, USDT, LTC, DOGE, SOL, BNB</li>
            </ul>

            <div class="docs-alert docs-alert-warning">
                <strong>Policy:</strong> All payments are non-refundable. Accounts are personal and non-transferable.
            </div>
        </section>

        <!-- ==================== LOGS ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'logs' }">
            <h1 class="docs-h1">Logging System</h1>

            <p class="docs-p">
                CryptoLens has a comprehensive logging system that tracks all significant events.
                Logs are stored in the database and viewable in the admin panel.
            </p>

            <h2 class="docs-h2">Log Categories</h2>
            <table class="docs-table">
                <tr><th>Category</th><th>Color</th><th>Description</th><th>Example Events</th></tr>
                <tr><td><span class="docs-badge docs-badge-green">fetch</span></td><td>Green</td><td>Data fetching</td><td>Candles fetched from exchange</td></tr>
                <tr><td><span class="docs-badge docs-badge-blue">aggregate</span></td><td>Blue</td><td>Aggregation</td><td>1m candles aggregated to higher TFs</td></tr>
                <tr><td><span class="docs-badge docs-badge-purple">scan</span></td><td>Purple</td><td>Pattern scanning</td><td>Patterns detected, expired</td></tr>
                <tr><td><span class="docs-badge docs-badge-yellow">signal</span></td><td>Yellow</td><td>Signal generation</td><td>Trade signals generated</td></tr>
                <tr><td><span class="docs-badge docs-badge-cyan">notify</span></td><td>Cyan</td><td>Notifications</td><td>Push notifications sent</td></tr>
                <tr><td><span class="docs-badge docs-badge-gray">system</span></td><td>Gray</td><td>System events</td><td>Server start, config changes</td></tr>
                <tr><td><span class="docs-badge docs-badge-red">error</span></td><td>Red</td><td>Errors</td><td>Exceptions, failures</td></tr>
                <tr><td><span class="docs-badge docs-badge-pink">auth</span></td><td>Pink</td><td>Authentication</td><td>Login, logout, register, password changes</td></tr>
                <tr><td><span class="docs-badge docs-badge-violet">user</span></td><td>Violet</td><td>User actions</td><td>Settings changes, profile updates</td></tr>
                <tr><td><span class="docs-badge docs-badge-emerald">trade</span></td><td>Emerald</td><td>Trading</td><td>Portfolio created, trade opened/closed</td></tr>
                <tr><td><span class="docs-badge docs-badge-orange">payment</span></td><td>Orange</td><td>Payments</td><td>Checkout created, subscription activated</td></tr>
                <tr><td><span class="docs-badge docs-badge-teal">backtest</span></td><td>Teal</td><td>Backtesting</td><td>Backtest started, completed, results</td></tr>
                <tr><td><span class="docs-badge docs-badge-indigo">api</span></td><td>Indigo</td><td>API access</td><td>API requests, rate limits</td></tr>
                <tr><td><span class="docs-badge docs-badge-darkred">admin</span></td><td>Dark Red</td><td>Admin actions</td><td>User management, subscription changes</td></tr>
            </table>

            <h2 class="docs-h2">Log Levels</h2>
            <table class="docs-table">
                <tr><th>Level</th><th>Usage</th></tr>
                <tr><td>DEBUG</td><td>Detailed debugging information</td></tr>
                <tr><td>INFO</td><td>Normal operation events</td></tr>
                <tr><td>WARNING</td><td>Unexpected but handled situations</td></tr>
                <tr><td>ERROR</td><td>Errors requiring attention</td></tr>
            </table>

            <h2 class="docs-h2">Log Entry Structure</h2>
            <div class="docs-codeblock">
{
    "timestamp": "2025-12-08T17:30:00Z",
    "category": "auth",
    "level": "INFO",
    "message": "User logged in: admin",
    "symbol": null,
    "timeframe": null,
    "details": {
        "user_id": 1,
        "email": "admin@example.com",
        "tier": "premium"
    }
}
            </div>

            <h2 class="docs-h2">Request ID Tracing</h2>
            <p class="docs-p">
                Each HTTP request is assigned a unique 8-character request ID (e.g., <code class="docs-code">a1b2c3d4</code>).
                This ID is included in all logs during that request and returned in the <code class="docs-code">X-Request-ID</code> header.
            </p>
        </section>

        <!-- ==================== API ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'api' }">
            <h1 class="docs-h1">API Reference</h1>

            <p class="docs-p">
                The CryptoLens API provides programmatic access to patterns, signals, and data.
                API access requires a Premium subscription.
            </p>

            <h2 class="docs-h2">Authentication</h2>
            <p class="docs-p">Include your API key in the <code class="docs-code">X-API-Key</code> header:</p>
            <div class="docs-codeblock">
curl -H "X-API-Key: your_api_key" https://app.cryptolens.io/api/patterns
            </div>

            <h2 class="docs-h2">Public Endpoints</h2>
            <table class="docs-table">
                <tr><th>Endpoint</th><th>Method</th><th>Description</th></tr>
                <tr><td>/api/health</td><td>GET</td><td>Health check (quick or full)</td></tr>
                <tr><td>/api/health/live</td><td>GET</td><td>Kubernetes liveness probe</td></tr>
                <tr><td>/api/health/ready</td><td>GET</td><td>Kubernetes readiness probe</td></tr>
                <tr><td>/api/symbols</td><td>GET</td><td>List tracked symbols</td></tr>
                <tr><td>/api/candles/{symbol}/{tf}</td><td>GET</td><td>Get candle data</td></tr>
                <tr><td>/api/patterns</td><td>GET</td><td>Get detected patterns</td></tr>
                <tr><td>/api/signals</td><td>GET</td><td>Get trade signals</td></tr>
                <tr><td>/api/matrix</td><td>GET</td><td>Get pattern matrix data</td></tr>
            </table>

            <h2 class="docs-h2">Protected Endpoints (API Key Required)</h2>
            <table class="docs-table">
                <tr><th>Endpoint</th><th>Method</th><th>Rate Limit</th><th>Description</th></tr>
                <tr><td>/api/scan</td><td>POST</td><td>1/min</td><td>Trigger pattern scan</td></tr>
                <tr><td>/api/fetch</td><td>POST</td><td>5/min</td><td>Trigger data fetch</td></tr>
                <tr><td>/api/scan/run</td><td>POST</td><td>1/min</td><td>Run full scan cycle</td></tr>
            </table>

            <h2 class="docs-h2">Interactive Documentation</h2>
            <p class="docs-p">
                Visit <a href="/api/docs" class="text-blue-400">/api/docs</a> for Swagger UI with full API documentation and testing.
            </p>
        </section>

        <!-- ==================== CONFIG ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'config' }">
            <h1 class="docs-h1">Configuration</h1>

            <h2 class="docs-h2">Environment Variables</h2>
            <table class="docs-table">
                <tr><th>Variable</th><th>Required</th><th>Description</th></tr>
                <tr><td colspan="3" class="text-cyan-400 font-bold">Flask</td></tr>
                <tr><td>SECRET_KEY</td><td>Prod</td><td>Flask secret key for sessions (auto-generated in dev)</td></tr>
                <tr><td>FLASK_ENV</td><td>Yes</td><td>development or production</td></tr>
                <tr><td colspan="3" class="text-cyan-400 font-bold">Database (Development)</td></tr>
                <tr><td>DB_HOST</td><td>Yes</td><td>MySQL host (default: localhost)</td></tr>
                <tr><td>DB_PORT</td><td>No</td><td>MySQL port (default: 3306)</td></tr>
                <tr><td>DB_USER</td><td>Yes</td><td>MySQL username</td></tr>
                <tr><td>DB_PASS</td><td>Yes</td><td>MySQL password</td></tr>
                <tr><td>DB_NAME</td><td>Yes</td><td>Database name (default: cryptolens)</td></tr>
                <tr><td colspan="3" class="text-cyan-400 font-bold">Database (Production)</td></tr>
                <tr><td>PROD_DB_HOST</td><td>Prod</td><td>Production MySQL host</td></tr>
                <tr><td>PROD_DB_PORT</td><td>No</td><td>Production MySQL port</td></tr>
                <tr><td>PROD_DB_USER</td><td>Prod</td><td>Production MySQL username</td></tr>
                <tr><td>PROD_DB_PASS</td><td>Prod</td><td>Production MySQL password</td></tr>
                <tr><td>PROD_DB_NAME</td><td>Prod</td><td>Production database name</td></tr>
                <tr><td>DATABASE_URL</td><td>Alt</td><td>Direct URL (overrides split config)</td></tr>
                <tr><td colspan="3" class="text-cyan-400 font-bold">Email</td></tr>
                <tr><td>MAIL_SERVER</td><td>Yes</td><td>SMTP server for email</td></tr>
                <tr><td>MAIL_PORT</td><td>Yes</td><td>SMTP port (587 for TLS)</td></tr>
                <tr><td>MAIL_USERNAME</td><td>Yes</td><td>SMTP username</td></tr>
                <tr><td>MAIL_PASSWORD</td><td>Yes</td><td>SMTP password/app password</td></tr>
                <tr><td colspan="3" class="text-cyan-400 font-bold">Services</td></tr>
                <tr><td>NTFY_URL</td><td>Yes</td><td>NTFY server URL</td></tr>
                <tr><td>REDIS_URL</td><td>Opt</td><td>Redis for caching and rate limiting</td></tr>
                <tr><td colspan="3" class="text-cyan-400 font-bold">Payments</td></tr>
                <tr><td>LEMONSQUEEZY_API_KEY</td><td>Opt</td><td>LemonSqueezy API key</td></tr>
                <tr><td>NOWPAYMENTS_API_KEY</td><td>Opt</td><td>NOWPayments API key</td></tr>
            </table>

            <div class="docs-alert docs-alert-info">
                <strong>Database Auto-Detection:</strong> The app automatically uses PROD_DB_* variables when FLASK_ENV=production or when running on common PaaS platforms (Heroku, Railway, Render, Vercel, Fly.io).
            </div>

            <h2 class="docs-h2">Pattern Detection Config</h2>
            <p class="docs-p">Located in <code class="docs-code">app/config.py</code>:</p>
            <div class="docs-codeblock">
TIMEFRAMES = ['1m', '5m', '15m', '30m', '1h', '2h', '4h', '1d']
FVG_MIN_GAP_PERCENT = 0.001  # 0.1% minimum gap size
ORDER_BLOCK_STRENGTH_MULTIPLIER = 1.5  # 1.5x avg body for OB
LIQUIDITY_SWING_LOOKBACK = 5  # Candles to look for swings
            </div>

            <h2 class="docs-h2">Rate Limiting</h2>
            <p class="docs-p">Default rate limits (can be customized):</p>
            <ul class="docs-list">
                <li>Login: 5 attempts per minute</li>
                <li>Registration: 3 per hour</li>
                <li>API (protected): varies by endpoint</li>
            </ul>

            <div class="docs-alert docs-alert-info">
                <strong>Production Tip:</strong> Use Redis for rate limiting in production:
                <code class="docs-code">RATELIMIT_STORAGE_URL=redis://localhost:6379/0</code>
            </div>
        </section>

        <!-- ==================== DEPLOYMENT ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'deployment' }">
            <h1 class="docs-h1">Deployment</h1>

            <h2 class="docs-h2">Production Checklist</h2>
            <ol class="docs-list">
                <li>Set <code class="docs-code">FLASK_ENV=production</code></li>
                <li>Set <code class="docs-code">SECRET_KEY</code> (generate with: <code class="docs-code">python -c "import secrets; print(secrets.token_hex(32))"</code>)</li>
                <li>Configure MySQL with <code class="docs-code">PROD_DB_*</code> environment variables</li>
                <li>Configure HTTPS with valid SSL certificate</li>
                <li>Set up Redis for rate limiting and caching</li>
                <li>Configure reverse proxy (nginx)</li>
                <li>Set up cron jobs for background tasks</li>
                <li>Configure log aggregation</li>
                <li>Set up monitoring (Prometheus + Grafana)</li>
            </ol>

            <h2 class="docs-h2">Database Setup</h2>
            <p class="docs-p">CryptoLens requires MySQL 8.0+ (uses BigInteger for millisecond timestamps).</p>

            <h3 class="docs-h3">Development Setup</h3>
            <div class="docs-codeblock"># Configure .env
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASS=your-password
DB_NAME=cryptolens

# Create database and tables
make db-create

# Create test users (admin, free, pro, premium)
make db-user

# Reset database (drop + create + users)
make db-reset</div>

            <h3 class="docs-h3">Production Setup</h3>
            <div class="docs-codeblock"># Configure .env for production
FLASK_ENV=production

PROD_DB_HOST=your-mysql-host.com
PROD_DB_PORT=3306
PROD_DB_USER=cryptolens_user
PROD_DB_PASS=secure-password-here
PROD_DB_NAME=cryptolens_prod

# Or use DATABASE_URL directly (overrides split config)
DATABASE_URL=mysql+pymysql://user:pass@host:3306/dbname</div>

            <h3 class="docs-h3">Makefile Commands</h3>
            <table class="docs-table">
                <tr><th>Command</th><th>Description</th></tr>
                <tr><td><code class="docs-code">make help</code></td><td>Show all available commands</td></tr>
                <tr><td><code class="docs-code">make db-create</code></td><td>Create database and tables</td></tr>
                <tr><td><code class="docs-code">make db-user</code></td><td>Create test users (admin + tiers)</td></tr>
                <tr><td><code class="docs-code">make db-reset</code></td><td>Drop, recreate, and add users</td></tr>
                <tr><td><code class="docs-code">make db-drop</code></td><td>Drop database (with confirmation)</td></tr>
                <tr><td><code class="docs-code">make db-shell</code></td><td>Open MySQL shell</td></tr>
                <tr><td><code class="docs-code">make dev</code></td><td>Start development server</td></tr>
                <tr><td><code class="docs-code">make test</code></td><td>Run test suite</td></tr>
                <tr><td><code class="docs-code">make run</code></td><td>Run with gunicorn (production-like)</td></tr>
            </table>

            <h2 class="docs-h2">Gunicorn Configuration</h2>
            <div class="docs-codeblock">
# gunicorn.conf.py
bind = "0.0.0.0:8000"
workers = 4
worker_class = "sync"
timeout = 120
accesslog = "-"
errorlog = "-"
            </div>

            <h2 class="docs-h2">Crontab Setup</h2>
            <div class="docs-codeblock">
# Install crontab
crontab crontab.txt

# crontab.txt contents:
* * * * * /path/to/venv/bin/python /path/to/scripts/fetch.py
*/5 * * * * /path/to/venv/bin/python /path/to/scripts/compute_stats.py
0 3 * * * /path/to/venv/bin/python /path/to/scripts/db_health.py
            </div>

            <h2 class="docs-h2">Nginx Configuration</h2>
            <div class="docs-codeblock">
server {
    listen 443 ssl http2;
    server_name app.cryptolens.io;

    ssl_certificate /etc/letsencrypt/live/.../fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/.../privkey.pem;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Request-ID $request_id;
    }
}
            </div>
        </section>

        <!-- ==================== SCRIPTS & CRON ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'scripts' }">
            <h1 class="docs-h1">Scripts & Cron Jobs</h1>

            <p class="docs-p">
                CryptoLens uses several Python scripts for background processing. These run via cron jobs
                to keep data fresh, detect patterns, and maintain system health.
            </p>

            <h2 class="docs-h2">Scripts Overview</h2>
            <table class="docs-table">
                <tr><th>Script</th><th>Purpose</th><th>Cron Schedule</th></tr>
                <tr><td><code class="docs-code">fetch.py</code></td><td>Real-time data pipeline - fetch, aggregate, detect, signal, notify</td><td>Every minute</td></tr>
                <tr><td><code class="docs-code">fetch_historical.py</code></td><td>Historical data load and gap filling (uses fetch_start_date setting)</td><td>Manual / Hourly (gaps)</td></tr>
                <tr><td><code class="docs-code">compute_stats.py</code></td><td>Pre-compute statistics cache for fast page loads</td><td>Every 5 minutes</td></tr>
                <tr><td><code class="docs-code">db_health.py</code></td><td>Data integrity verification and repair</td><td>Daily at 3 AM</td></tr>
                <tr><td><code class="docs-code">init_db.py</code></td><td>MySQL database creation and initialization</td><td>Manual (initial setup)</td></tr>
                <tr><td><code class="docs-code">migrate_all.py</code></td><td>Database schema migrations (upgrades)</td><td>Manual (on deploy)</td></tr>
                <tr><td><code class="docs-code">create_admin.py</code></td><td>Create admin and test accounts</td><td>Manual (initial setup)</td></tr>
            </table>

            <!-- ==================== FETCH.PY ==================== -->
            <h2 class="docs-h2">fetch.py - Real-time Data Pipeline</h2>
            <p class="docs-p">
                The core script that runs every minute. Fetches latest candles from Binance, aggregates to higher timeframes,
                detects patterns, generates signals, and sends notifications.
            </p>

            <h3 class="docs-h3">Data Flow</h3>
            <div class="docs-diagram">1. Check last candle timestamp in DB
2. Fetch all 1m candles from there to now (via CCXT/Binance)
3. Save new candles to database
4. Aggregate to higher timeframes (5m, 15m, 30m, 1h, 2h, 4h, 1d)
5. Detect patterns on all fetched candles (FVG, OB, Sweep)
6. Update pattern status with current price
7. Generate signals (when 2+ timeframes align)
8. Expire old patterns (based on timeframe expiry rules)
9. Send notifications (to matching users)
10. Log run to database (CronRun entry)</div>

            <h3 class="docs-h3">Command Line Options</h3>
            <table class="docs-table">
                <tr><th>Option</th><th>Description</th><th>Example</th></tr>
                <tr><td><code class="docs-code">--verbose, -v</code></td><td>Enable verbose output with detailed progress</td><td><code class="docs-code">python scripts/fetch.py -v</code></td></tr>
                <tr><td><code class="docs-code">--gaps</code></td><td>Fill data gaps mode (runs as 'gaps' job)</td><td><code class="docs-code">python scripts/fetch.py --gaps</code></td></tr>
            </table>

            <h3 class="docs-h3">Usage Examples</h3>
            <div class="docs-codeblock"># Standard run (every minute via cron)
python scripts/fetch.py

# Verbose output for debugging
python scripts/fetch.py -v

# Gap filling mode (hourly cron)
python scripts/fetch.py --gaps</div>

            <h3 class="docs-h3">Output</h3>
            <div class="docs-codeblock">[21:30:45] Fetching... done. 156 candles, 12 patterns, 2 signals (8.3s)</div>

            <!-- ==================== FETCH_HISTORICAL.PY ==================== -->
            <h2 class="docs-h2">fetch_historical.py - Historical Data &amp; Gap Fill</h2>
            <p class="docs-p">
                Fetches historical candle data for initial setup, backfilling, or gap detection. Uses the <strong>fetch_start_date</strong> setting from Admin &gt; Symbols (default: 2024-01-01).
            </p>

            <h3 class="docs-h3">Command Line Options</h3>
            <table class="docs-table">
                <tr><th>Option</th><th>Description</th><th>Default</th></tr>
                <tr><td><code class="docs-code">--days N</code></td><td>Override days (ignores fetch_start_date setting)</td><td>Uses setting</td></tr>
                <tr><td><code class="docs-code">--gaps</code></td><td>Only find and fill gaps (for hourly cron)</td><td>Off</td></tr>
                <tr><td><code class="docs-code">--full</code></td><td>With --gaps: scan entire database, not just last X days</td><td>Off</td></tr>
                <tr><td><code class="docs-code">--status</code></td><td>Show database status (candle counts, date ranges)</td><td>-</td></tr>
                <tr><td><code class="docs-code">--delete</code></td><td>Delete ALL data (requires typing 'DELETE' to confirm)</td><td>-</td></tr>
                <tr><td><code class="docs-code">--verbose, -v</code></td><td>Verbose output</td><td>Off</td></tr>
                <tr><td><code class="docs-code">--no-aggregate</code></td><td>Skip aggregation after fetching</td><td>Off</td></tr>
            </table>

            <h3 class="docs-h3">Usage Examples</h3>
            <div class="docs-codeblock"># Initial load - fetch from fetch_start_date (Admin > Symbols)
python scripts/fetch_historical.py

# Override with specific number of days
python scripts/fetch_historical.py --days 30

# Gap fill mode (finds missing candles and fetches them)
python scripts/fetch_historical.py --gaps

# Gap fill scanning entire database (not just last X days)
python scripts/fetch_historical.py --gaps --full

# Check database status
python scripts/fetch_historical.py --status

# Delete all data (DANGEROUS - requires confirmation)
python scripts/fetch_historical.py --delete

# Verbose with 90 days override
python scripts/fetch_historical.py --days 90 -v</div>

            <h3 class="docs-h3">Fetch Output Example</h3>
            <div class="docs-codeblock">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  CryptoLens Historical Data Fetcher
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Loading...
  Mode: Gap fill (full DB)
  Symbols: 5
    â€¢ BTC/USDT
    â€¢ ETH/USDT
    â€¢ BNB/USDT
    â€¢ XRP/USDT
    â€¢ SOL/USDT
  Period: Entire database to now
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BTC/USDT: 1 gap(s), 1,440 candles filled
  ETH/USDT: No gaps found
  ...</div>

            <h3 class="docs-h3">Status Output Example</h3>
            <div class="docs-codeblock">â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  Database Status
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  BTC/USDT     |    525,600 | 2024-01-01 â†’ 2024-12-10 21:30
  ETH/USDT     |    525,600 | 2024-01-01 â†’ 2024-12-10 21:30
  SOL/USDT     |    144,000 | 2024-09-01 â†’ 2024-12-10 21:30
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Total: 1,195,200 candles (1m)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•</div>

            <div class="docs-alert docs-alert-info">
                <strong>Target Date:</strong> The script uses the <code class="docs-code">fetch_start_date</code> setting from Admin &gt; Symbols (default: 2024-01-01). Use <code class="docs-code">--days N</code> to override.
            </div>

            <div class="docs-alert docs-alert-warning">
                <strong>Warning:</strong> The <code class="docs-code">--delete</code> flag will delete ALL candles, patterns, signals, and notifications. You must type 'DELETE' to confirm.
            </div>

            <h3 class="docs-h3">Error Handling &amp; Resilience</h3>
            <p class="docs-p">
                The script handles errors gracefully and is designed to be crash-safe:
            </p>

            <table class="docs-table">
                <tr><th>Feature</th><th>Behavior</th></tr>
                <tr><td><strong>Incremental Saves</strong></td><td>Data saved to database every 10,000 candles (~1 week of 1m data)</td></tr>
                <tr><td><strong>Retry on Timeout</strong></td><td>3 retries with 10s delay between attempts</td></tr>
                <tr><td><strong>Rate Limit Handling</strong></td><td>Dynamic cooloff - extracts wait time from error message (default 30s, max 5min)</td></tr>
                <tr><td><strong>Error Logging</strong></td><td>All errors logged with symbol, timestamp, and attempt count</td></tr>
                <tr><td><strong>Graceful Skip</strong></td><td>Skips problematic batches after max retries, continues with next</td></tr>
                <tr><td><strong>Abort Protection</strong></td><td>Aborts symbol after 9 consecutive errors to prevent infinite loops</td></tr>
            </table>

            <h3 class="docs-h3">Error Types &amp; Log Levels</h3>
            <table class="docs-table">
                <tr><th>Error Type</th><th>Action</th><th>Log Level</th></tr>
                <tr><td>Rate limit (429)</td><td>Extract wait time, cooloff (30s-5min)</td><td>WARNING</td></tr>
                <tr><td>Timeout</td><td>Retry after 10s</td><td>WARNING</td></tr>
                <tr><td>Other errors</td><td>Retry after 5s</td><td>ERROR</td></tr>
                <tr><td>Max retries exceeded</td><td>Skip batch, continue</td><td>ERROR</td></tr>
                <tr><td>Too many consecutive (9)</td><td>Abort symbol fetch</td><td>ERROR</td></tr>
            </table>

            <div class="docs-alert docs-alert-info">
                <strong>Dynamic Rate Limit:</strong> The script parses error messages like "retry after 60 seconds" or "Retry-After: 30" to determine wait time. If no time is specified, it defaults to 30 seconds. Maximum wait is capped at 5 minutes.
            </div>

            <!-- ==================== COMPUTE_STATS.PY ==================== -->
            <h2 class="docs-h2">compute_stats.py - Statistics Cache</h2>
            <p class="docs-p">
                Pre-computes database statistics and caches them for fast page loads. Run every 5 minutes via cron.
            </p>

            <h3 class="docs-h3">What It Caches</h3>
            <ul class="docs-list">
                <li><strong>Global Stats</strong> - Total candles, patterns, signals, database size</li>
                <li><strong>Per-Symbol Stats</strong> - Candle counts by timeframe, date ranges, pattern counts</li>
                <li><strong>Price Data</strong> - Current price, 24h change for each symbol</li>
                <li><strong>Freshness</strong> - Data age indicator (live, recent, stale, old)</li>
                <li><strong>Verification</strong> - Last verified timestamp, verification percentage</li>
            </ul>

            <h3 class="docs-h3">Usage</h3>
            <div class="docs-codeblock"># Standard run
python scripts/compute_stats.py</div>

            <h3 class="docs-h3">Output</h3>
            <div class="docs-codeblock">Stats computed and cached in 0.84s
  Symbols: 22, Candles: 11,547,200, Patterns: 1,234, Signals: 456</div>

            <!-- ==================== DB_HEALTH.PY ==================== -->
            <h2 class="docs-h2">db_health.py - Data Integrity</h2>
            <p class="docs-p">
                Incrementally verifies candle data integrity. Checks from first unverified candle,
                marks as verified on success, stops on error. Run daily at 3 AM.
            </p>

            <h3 class="docs-h3">Checks Performed</h3>
            <table class="docs-table">
                <tr><th>Check</th><th>Description</th><th>Fix Action</th></tr>
                <tr><td>OHLCV Validity</td><td>high &gt;= low, high &gt;= open/close, prices &gt; 0, volume &gt;= 0</td><td>Delete invalid candle</td></tr>
                <tr><td>Timestamp Alignment</td><td>Timestamps align to timeframe boundaries (5m at :00/:05, etc.)</td><td>Delete misaligned candle</td></tr>
                <tr><td>Gap Detection</td><td>Missing candles in sequence</td><td>Fetch from exchange, or mark as known gap</td></tr>
                <tr><td>Continuity</td><td>Open should equal previous close (informational only)</td><td>None (crypto can gap)</td></tr>
            </table>

            <h3 class="docs-h3">Command Line Options</h3>
            <table class="docs-table">
                <tr><th>Option</th><th>Description</th><th>Example</th></tr>
                <tr><td><code class="docs-code">--fix</code></td><td>Auto-fix: delete invalid, fetch missing, re-aggregate</td><td><code class="docs-code">--fix</code></td></tr>
                <tr><td><code class="docs-code">--symbol NAME</code></td><td>Check specific symbol only</td><td><code class="docs-code">--symbol BTC/USDT</code></td></tr>
                <tr><td><code class="docs-code">--reset</code></td><td>Reset all verification flags (re-check everything)</td><td><code class="docs-code">--reset</code></td></tr>
                <tr><td><code class="docs-code">--quiet, -q</code></td><td>Only show summary (for cron)</td><td><code class="docs-code">-q</code></td></tr>
                <tr><td><code class="docs-code">--accept-gaps</code></td><td>Mark current gaps as "accepted" (exchange has no data)</td><td><code class="docs-code">--accept-gaps</code></td></tr>
                <tr><td><code class="docs-code">--show-gaps</code></td><td>Show all known/accepted gaps</td><td><code class="docs-code">--show-gaps</code></td></tr>
                <tr><td><code class="docs-code">--clear-gaps</code></td><td>Clear all known gaps (to re-verify them)</td><td><code class="docs-code">--clear-gaps</code></td></tr>
            </table>

            <h3 class="docs-h3">Gap Handling</h3>
            <p class="docs-p">
                When <code class="docs-code">--fix</code> encounters a gap in 1m candles:
            </p>
            <ol class="docs-list">
                <li>Attempts to fetch missing candles from Binance</li>
                <li>If data found: saves candles and re-aggregates higher timeframes</li>
                <li>If exchange has no data: marks gap as "known" and continues verification</li>
                <li>Known gaps are skipped on future runs (no errors)</li>
            </ol>
            <p class="docs-p">
                Use <code class="docs-code">--accept-gaps</code> to manually mark gaps as OK without fetching (e.g., exchange maintenance periods).
            </p>

            <h3 class="docs-h3">Usage Examples</h3>
            <div class="docs-codeblock"># Check only (report issues, no changes)
python scripts/db_health.py

# Auto-fix: delete invalid, fetch missing, re-aggregate
python scripts/db_health.py --fix

# Check specific symbol only
python scripts/db_health.py --symbol BTC/USDT

# Reset verification and re-check everything
python scripts/db_health.py --reset

# Show all known gaps
python scripts/db_health.py --show-gaps

# Mark current gaps as "accepted" (exchange has no data)
python scripts/db_health.py --accept-gaps

# Clear known gaps to re-verify them
python scripts/db_health.py --clear-gaps

# Quiet mode for cron
python scripts/db_health.py --fix -q</div>

            <!-- ==================== MIGRATE_ALL.PY ==================== -->
            <h2 class="docs-h2">migrate_all.py - Database Migrations</h2>
            <p class="docs-p">
                Runs all database schema migrations for upgrading existing databases.
                <strong>Not needed for new installations</strong> - db.create_all() includes everything.
            </p>

            <h3 class="docs-h3">What It Does</h3>
            <ul class="docs-list">
                <li>Adds new columns to existing tables</li>
                <li>Creates new tables if missing</li>
                <li>Creates missing indexes</li>
                <li>Encrypts unencrypted TOTP secrets</li>
                <li>Seeds default notification templates</li>
            </ul>

            <h3 class="docs-h3">Usage</h3>
            <div class="docs-codeblock"># Run migrations
python scripts/migrate_all.py</div>

            <h3 class="docs-h3">Output Example</h3>
            <div class="docs-codeblock">Migrations applied:
  - Added candles.verified_at
  - Created stats_cache table
  - Added idx_pattern_list index
  - Created 6 default notification templates</div>

            <!-- ==================== INIT_DB.PY ==================== -->
            <h2 class="docs-h2">init_db.py - Database Initialization</h2>
            <p class="docs-p">
                Creates and manages MySQL database. Used by Makefile commands.
            </p>

            <h3 class="docs-h3">Command Line Options</h3>
            <table class="docs-table">
                <tr><th>Option</th><th>Description</th></tr>
                <tr><td><code class="docs-code">(none)</code></td><td>Initialize tables only (database must exist)</td></tr>
                <tr><td><code class="docs-code">--create</code></td><td>Create database + tables</td></tr>
                <tr><td><code class="docs-code">--drop</code></td><td>Drop database (with confirmation)</td></tr>
                <tr><td><code class="docs-code">--migrate PATH</code></td><td>Migrate from SQLite file to MySQL</td></tr>
            </table>

            <h3 class="docs-h3">Usage</h3>
            <div class="docs-codeblock"># Create database and tables (same as: make db-create)
python scripts/init_db.py --create

# Drop database (same as: make db-drop)
python scripts/init_db.py --drop

# Initialize tables only (database must exist)
python scripts/init_db.py

# Migrate from SQLite to MySQL
python scripts/init_db.py --migrate data/cryptolens.db</div>

            <div class="docs-alert docs-alert-info">
                <strong>Tip:</strong> Use Makefile commands instead: <code class="docs-code">make db-create</code>, <code class="docs-code">make db-drop</code>, <code class="docs-code">make db-reset</code>
            </div>

            <!-- ==================== CREATE_ADMIN.PY ==================== -->
            <h2 class="docs-h2">create_admin.py - Test Accounts</h2>
            <p class="docs-p">
                Creates admin and test accounts for development/testing. Idempotent - safe to run multiple times.
            </p>

            <h3 class="docs-h3">Accounts Created</h3>
            <table class="docs-table">
                <tr><th>Email</th><th>Username</th><th>Password</th><th>Tier</th></tr>
                <tr><td>admin@cryptolens.local</td><td>admin</td><td>Admin123</td><td>Admin + Premium</td></tr>
                <tr><td>free@cryptolens.local</td><td>freeuser</td><td>Free123</td><td>Free</td></tr>
                <tr><td>pro@cryptolens.local</td><td>prouser</td><td>Pro123</td><td>Pro</td></tr>
                <tr><td>premium@cryptolens.local</td><td>premiumuser</td><td>Premium123</td><td>Premium</td></tr>
            </table>

            <h3 class="docs-h3">Usage</h3>
            <div class="docs-codeblock"># Create test accounts
python scripts/create_admin.py</div>

            <div class="docs-alert docs-alert-warning">
                <strong>Important:</strong> Change passwords after testing! These are well-known test credentials.
            </div>

            <!-- ==================== WHEN TO USE WHICH SCRIPT ==================== -->
            <h2 class="docs-h2">When to Use Which Script</h2>
            <p class="docs-p">Quick reference for common scenarios:</p>

            <table class="docs-table">
                <tr><th>Scenario</th><th>Script</th><th>Command</th></tr>
                <tr><td><strong>First time setup</strong></td><td>fetch_historical.py</td><td><code class="docs-code">python scripts/fetch_historical.py -v</code></td></tr>
                <tr><td><strong>Regular cron job</strong></td><td>fetch.py</td><td><code class="docs-code">python scripts/fetch.py</code></td></tr>
                <tr><td><strong>Missing 1m candles</strong></td><td>fetch_historical.py --gaps</td><td><code class="docs-code">python scripts/fetch_historical.py --gaps -v</code></td></tr>
                <tr><td><strong>Missing higher TF candles</strong></td><td>Re-aggregate (see below)</td><td>Python one-liner</td></tr>
                <tr><td><strong>Data looks wrong</strong></td><td>db_health.py</td><td><code class="docs-code">python scripts/db_health.py --fix</code></td></tr>
                <tr><td><strong>Dashboard slow</strong></td><td>compute_stats.py</td><td><code class="docs-code">python scripts/compute_stats.py</code></td></tr>
                <tr><td><strong>After code update</strong></td><td>migrate_all.py</td><td><code class="docs-code">python scripts/migrate_all.py</code></td></tr>
            </table>

            <h3 class="docs-h3">Re-aggregate Higher Timeframes</h3>
            <p class="docs-p">If 5m/15m/1h/etc candles are missing but 1m candles exist:</p>
            <div class="docs-codeblock">python -c "
from app import create_app
from app.models import Symbol
from app.services.aggregator import aggregate_all_timeframes

app = create_app()
with app.app_context():
    for sym in Symbol.query.filter_by(is_active=True).all():
        print(f'{sym.symbol}...', end=' ', flush=True)
        results = aggregate_all_timeframes(sym.symbol)
        print(f'{sum(results.values())} candles')
"</div>

            <h3 class="docs-h3">Catching Up After Downtime</h3>
            <table class="docs-table">
                <tr><th>Gap Size</th><th>Recommended Approach</th><th>Command</th></tr>
                <tr><td>&lt; 1 day</td><td>fetch.py (auto-catches up)</td><td><code class="docs-code">python scripts/fetch.py -v</code></td></tr>
                <tr><td>1-7 days</td><td>Gap fill mode</td><td><code class="docs-code">python scripts/fetch_historical.py --gaps -v</code></td></tr>
                <tr><td>&gt; 7 days</td><td>Full database gap scan</td><td><code class="docs-code">python scripts/fetch_historical.py --gaps --full -v</code></td></tr>
            </table>

            <!-- ==================== CRON SCHEDULE ==================== -->
            <h2 class="docs-h2">Recommended Cron Schedule</h2>
            <p class="docs-p">Production crontab configuration:</p>

            <div class="docs-codeblock"># Real-time data pipeline (every minute)
* * * * * cd /path/to/cryptolens && venv/bin/python scripts/fetch.py >> logs/fetch.log 2>&1

# Gap filling (hourly)
0 * * * * cd /path/to/cryptolens && venv/bin/python scripts/fetch_historical.py --gaps >> logs/gaps.log 2>&1

# Statistics cache (every 5 minutes)
*/5 * * * * cd /path/to/cryptolens && venv/bin/python scripts/compute_stats.py >> logs/stats.log 2>&1

# Data integrity check (daily at 3 AM)
0 3 * * * cd /path/to/cryptolens && venv/bin/python scripts/db_health.py --fix >> logs/health.log 2>&1</div>

            <!-- ==================== ADMIN QUICK ACTIONS ==================== -->
            <h2 class="docs-h2">Admin Quick Actions</h2>
            <p class="docs-p">
                These actions can also be triggered from the Admin panel (Admin &gt; Quick Actions).
                They run in the background and log to the Cron Jobs page.
            </p>

            <table class="docs-table">
                <tr><th>Button</th><th>What It Does</th><th>Equivalent Script</th></tr>
                <tr><td><strong>Full Cycle</strong></td><td>Fetch â†’ Pattern Scan â†’ Stats (sequential)</td><td>fetch.py + scan + compute_stats.py</td></tr>
                <tr><td><strong>Fetch</strong></td><td>Fetch latest candle data from exchange</td><td>fetch.py</td></tr>
                <tr><td><strong>Scan</strong></td><td>Scan existing candles for patterns</td><td>Pattern detection only</td></tr>
                <tr><td><strong>Stats</strong></td><td>Refresh statistics cache</td><td>compute_stats.py</td></tr>
                <tr><td><strong>Cleanup</strong></td><td>Database health check with auto-fix</td><td>db_health.py --fix</td></tr>
            </table>

            <h3 class="docs-h3">Cron Job Monitoring</h3>
            <p class="docs-p">
                View cron job status in Admin &gt; Cron Jobs. Each run is logged with:
            </p>
            <ul class="docs-list">
                <li>Start/end timestamps and duration</li>
                <li>Success/failure status with error messages</li>
                <li>Statistics: Symbols processed, Candles fetched, Patterns found</li>
                <li>Success rate and average duration</li>
            </ul>

            <p class="docs-p">
                Jobs stuck in "Running..." for more than 1 hour are automatically marked as failed.
            </p>
        </section>

        <!-- ==================== SERVICES ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'services' }">
            <h1 class="docs-h1">Services Architecture</h1>

            <p class="docs-p">
                The <code class="docs-code">app/services/</code> directory contains all business logic, separated from routes.
                This keeps routes thin and logic testable.
            </p>

            <h2 class="docs-h2">Service Files</h2>
            <table class="docs-table">
                <tr><th>Service</th><th>Purpose</th></tr>
                <tr><td><code class="docs-code">auth.py</code></td><td>User authentication, session management, 2FA</td></tr>
                <tr><td><code class="docs-code">email.py</code></td><td>Email sending (verification, password reset)</td></tr>
                <tr><td><code class="docs-code">notifier.py</code></td><td>NTFY push notification sending</td></tr>
                <tr><td><code class="docs-code">async_notifier.py</code></td><td>Async notification sending with connection pooling</td></tr>
                <tr><td><code class="docs-code">data_fetcher.py</code></td><td>CCXT exchange data fetching</td></tr>
                <tr><td><code class="docs-code">aggregator.py</code></td><td>Candle aggregation (1m -> higher TFs)</td></tr>
                <tr><td><code class="docs-code">signals.py</code></td><td>Confluence calculation, signal generation</td></tr>
                <tr><td><code class="docs-code">subscription.py</code></td><td>Subscription management, tier checks</td></tr>
                <tr><td><code class="docs-code">payment.py</code></td><td>LemonSqueezy, NOWPayments integration</td></tr>
                <tr><td><code class="docs-code">backtester.py</code></td><td>Historical strategy backtesting</td></tr>
                <tr><td><code class="docs-code">logger.py</code></td><td>Database logging with categories</td></tr>
                <tr><td><code class="docs-code">error_tracker.py</code></td><td>Exception tracking and email alerts</td></tr>
                <tr><td><code class="docs-code">lockout.py</code></td><td>Account lockout after failed logins</td></tr>
                <tr><td><code class="docs-code">encryption.py</code></td><td>Fernet encryption for sensitive data</td></tr>
                <tr><td><code class="docs-code">health.py</code></td><td>System health checks for monitoring</td></tr>
                <tr><td><code class="docs-code">scheduler.py</code></td><td>Notification scheduling</td></tr>
                <tr><td><code class="docs-code">broadcast.py</code></td><td>Admin mass notification broadcasts</td></tr>
                <tr><td><code class="docs-code">trading.py</code></td><td>Portfolio and trade management</td></tr>
            </table>

            <h2 class="docs-h2">Pattern Detectors</h2>
            <p class="docs-p">
                Pattern detection logic is in <code class="docs-code">app/services/patterns/</code>:
            </p>
            <table class="docs-table">
                <tr><th>File</th><th>Pattern</th><th>Key Function</th></tr>
                <tr><td><code class="docs-code">fair_value_gap.py</code></td><td>FVG</td><td><code class="docs-code">detect_fvg(candles)</code></td></tr>
                <tr><td><code class="docs-code">order_block.py</code></td><td>Order Block</td><td><code class="docs-code">detect_order_blocks(candles)</code></td></tr>
                <tr><td><code class="docs-code">liquidity.py</code></td><td>Liquidity Sweep</td><td><code class="docs-code">detect_sweeps(candles)</code></td></tr>
                <tr><td><code class="docs-code">base.py</code></td><td>Base class</td><td>Common pattern utilities</td></tr>
                <tr><td><code class="docs-code">__init__.py</code></td><td>Orchestration</td><td><code class="docs-code">scan_all_patterns()</code></td></tr>
            </table>

            <h2 class="docs-h2">Route Blueprints</h2>
            <p class="docs-p">
                Routes in <code class="docs-code">app/routes/</code> handle HTTP requests:
            </p>
            <table class="docs-table">
                <tr><th>Blueprint</th><th>Prefix</th><th>Purpose</th></tr>
                <tr><td><code class="docs-code">main</code></td><td>/</td><td>Landing page, health checks</td></tr>
                <tr><td><code class="docs-code">auth</code></td><td>/auth</td><td>Login, register, password reset, profile</td></tr>
                <tr><td><code class="docs-code">dashboard</code></td><td>/</td><td>Dashboard, pattern matrix</td></tr>
                <tr><td><code class="docs-code">patterns</code></td><td>/patterns</td><td>Pattern list and detail views</td></tr>
                <tr><td><code class="docs-code">signals</code></td><td>/signals</td><td>Signal list (also in /patterns tab)</td></tr>
                <tr><td><code class="docs-code">portfolio</code></td><td>/portfolio</td><td>Portfolio and trade management</td></tr>
                <tr><td><code class="docs-code">backtest</code></td><td>/backtest</td><td>Backtesting interface</td></tr>
                <tr><td><code class="docs-code">api</code></td><td>/api</td><td>REST API endpoints</td></tr>
                <tr><td><code class="docs-code">admin</code></td><td>/admin</td><td>Admin panel</td></tr>
                <tr><td><code class="docs-code">payments</code></td><td>/payments</td><td>Payment processing, webhooks</td></tr>
                <tr><td><code class="docs-code">settings</code></td><td>/settings</td><td>User and system settings</td></tr>
                <tr><td><code class="docs-code">docs</code></td><td>/api/docs</td><td>Swagger UI, OpenAPI spec</td></tr>
                <tr><td><code class="docs-code">metrics</code></td><td>/metrics</td><td>Prometheus metrics endpoint</td></tr>
            </table>
        </section>

        <!-- ==================== DATABASE MODELS ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'models' }">
            <h1 class="docs-h1">Database Models</h1>

            <p class="docs-p">
                Database models are in <code class="docs-code">app/models/</code>, organized by domain.
                All models use SQLAlchemy ORM.
            </p>

            <h2 class="docs-h2">Model Files</h2>
            <table class="docs-table">
                <tr><th>File</th><th>Models</th></tr>
                <tr><td><code class="docs-code">user.py</code></td><td>User, Subscription, UserNotification</td></tr>
                <tr><td><code class="docs-code">trading.py</code></td><td>Symbol, Candle, Pattern, Signal</td></tr>
                <tr><td><code class="docs-code">portfolio.py</code></td><td>Portfolio, Trade, JournalEntry, TradeTag</td></tr>
                <tr><td><code class="docs-code">system.py</code></td><td>Setting, Log, CronJob, Notification, StatsCache</td></tr>
                <tr><td><code class="docs-code">errors.py</code></td><td>ErrorLog</td></tr>
                <tr><td><code class="docs-code">base.py</code></td><td>Constants, enums, utility functions</td></tr>
            </table>

            <h2 class="docs-h2">Core Tables</h2>

            <h3 class="docs-h3">users</h3>
            <p class="docs-p">User accounts with authentication and preferences.</p>
            <table class="docs-table">
                <tr><th>Column</th><th>Type</th><th>Description</th></tr>
                <tr><td>id</td><td>Integer</td><td>Primary key</td></tr>
                <tr><td>email</td><td>String</td><td>Unique email address</td></tr>
                <tr><td>username</td><td>String</td><td>Display name</td></tr>
                <tr><td>password_hash</td><td>String</td><td>PBKDF2 hashed password</td></tr>
                <tr><td>is_admin</td><td>Boolean</td><td>Admin privileges</td></tr>
                <tr><td>is_verified</td><td>Boolean</td><td>Email verified</td></tr>
                <tr><td>totp_secret</td><td>String</td><td>2FA secret (encrypted)</td></tr>
                <tr><td>ntfy_topic</td><td>String</td><td>Unique notification topic</td></tr>
                <tr><td>notify_*</td><td>Various</td><td>Notification preferences</td></tr>
                <tr><td>user_timezone</td><td>String</td><td>Display timezone preference</td></tr>
            </table>

            <h3 class="docs-h3">candles</h3>
            <p class="docs-p">OHLCV price data for all symbols and timeframes.</p>
            <table class="docs-table">
                <tr><th>Column</th><th>Type</th><th>Description</th></tr>
                <tr><td>id</td><td>Integer</td><td>Primary key</td></tr>
                <tr><td>symbol_id</td><td>FK</td><td>Reference to symbols table</td></tr>
                <tr><td>timeframe</td><td>String</td><td>1m, 5m, 15m, 1h, 4h, 1d</td></tr>
                <tr><td>timestamp</td><td>BigInteger</td><td>Unix timestamp (ms)</td></tr>
                <tr><td>open, high, low, close</td><td>Float</td><td>Price data</td></tr>
                <tr><td>volume</td><td>Float</td><td>Trading volume</td></tr>
            </table>
            <p class="docs-p"><strong>Index:</strong> <code class="docs-code">(symbol_id, timeframe, timestamp DESC)</code> for fast queries.</p>

            <h3 class="docs-h3">patterns</h3>
            <p class="docs-p">Detected trading patterns.</p>
            <table class="docs-table">
                <tr><th>Column</th><th>Type</th><th>Description</th></tr>
                <tr><td>id</td><td>Integer</td><td>Primary key</td></tr>
                <tr><td>symbol_id</td><td>FK</td><td>Reference to symbols</td></tr>
                <tr><td>timeframe</td><td>String</td><td>Pattern timeframe</td></tr>
                <tr><td>pattern_type</td><td>String</td><td>fvg, ob, sweep</td></tr>
                <tr><td>direction</td><td>String</td><td>bullish, bearish</td></tr>
                <tr><td>zone_high, zone_low</td><td>Float</td><td>Pattern zone boundaries</td></tr>
                <tr><td>status</td><td>String</td><td>active, filled, expired</td></tr>
                <tr><td>strength</td><td>Float</td><td>Pattern quality score (0-1)</td></tr>
                <tr><td>detected_at</td><td>BigInteger</td><td>Detection timestamp (ms)</td></tr>
            </table>

            <h3 class="docs-h3">signals</h3>
            <p class="docs-p">Trade signals generated from pattern confluence.</p>
            <table class="docs-table">
                <tr><th>Column</th><th>Type</th><th>Description</th></tr>
                <tr><td>id</td><td>Integer</td><td>Primary key</td></tr>
                <tr><td>symbol_id</td><td>FK</td><td>Reference to symbols</td></tr>
                <tr><td>direction</td><td>String</td><td>long, short</td></tr>
                <tr><td>entry_price</td><td>Float</td><td>Suggested entry</td></tr>
                <tr><td>stop_loss</td><td>Float</td><td>Stop loss level</td></tr>
                <tr><td>take_profit_1, take_profit_2</td><td>Float</td><td>Profit targets</td></tr>
                <tr><td>confluence</td><td>Integer</td><td>Number of aligned TFs</td></tr>
                <tr><td>timeframes</td><td>String</td><td>JSON array of aligned TFs</td></tr>
                <tr><td>status</td><td>String</td><td>active, filled, expired</td></tr>
            </table>

            <h2 class="docs-h2">Entity Relationships</h2>
            <div class="docs-diagram">User 1--N Subscription
User 1--N Portfolio 1--N Trade 1--N JournalEntry
User 1--N UserNotification

Symbol 1--N Candle
Symbol 1--N Pattern
Symbol 1--N Signal

Pattern N--1 Symbol
Signal N--1 Symbol</div>
        </section>

        <!-- ==================== DATA RETENTION ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'retention' }">
            <h1 class="docs-h1">Data Retention Policy</h1>

            <p class="docs-p">
                CryptoLens preserves all historical data indefinitely. Nothing is automatically deleted.
                This ensures you always have access to historical patterns, signals, and logs for analysis.
            </p>

            <h2 class="docs-h2">Data Preservation</h2>
            <table class="docs-table">
                <tr><th>Data Type</th><th>Retention</th><th>Notes</th></tr>
                <tr><td><strong>Candles</strong></td><td>Forever</td><td>All historical price data preserved</td></tr>
                <tr><td><strong>Patterns</strong></td><td>Forever</td><td>Status changes (active â†’ expired), not deleted</td></tr>
                <tr><td><strong>Signals</strong></td><td>Forever</td><td>All trade signals preserved</td></tr>
                <tr><td><strong>Logs</strong></td><td>Forever</td><td>All system logs preserved</td></tr>
                <tr><td><strong>Notifications</strong></td><td>Forever</td><td>Notification history preserved</td></tr>
                <tr><td><strong>Error Logs</strong></td><td>Forever</td><td>All errors preserved for debugging</td></tr>
                <tr><td><strong>Users</strong></td><td>Forever</td><td>Soft delete (is_active=false)</td></tr>
            </table>

            <div class="docs-alert docs-alert-success">
                <strong>Data Preservation Policy:</strong> All historical data is kept for analysis.
                The cleanup job only reports statistics - it does NOT delete any records.
            </div>

            <h2 class="docs-h2">Status Changes (Not Deletion)</h2>
            <p class="docs-p">Instead of deleting, records change status:</p>

            <h3 class="docs-h3">Patterns</h3>
            <table class="docs-table">
                <tr><th>From</th><th>To</th><th>When</th></tr>
                <tr><td>active</td><td>filled</td><td>Price touches pattern zone</td></tr>
                <tr><td>active</td><td>expired</td><td>Pattern exceeds timeframe expiry</td></tr>
            </table>

            <h3 class="docs-h3">Pattern Expiry Times</h3>
            <table class="docs-table">
                <tr><th>Timeframe</th><th>Expiry After</th></tr>
                <tr><td>1m</td><td>4 hours</td></tr>
                <tr><td>5m</td><td>12 hours</td></tr>
                <tr><td>15m</td><td>24 hours</td></tr>
                <tr><td>1h</td><td>3 days</td></tr>
                <tr><td>4h</td><td>7 days</td></tr>
                <tr><td>1d</td><td>14 days</td></tr>
            </table>

            <h3 class="docs-h3">Subscriptions</h3>
            <table class="docs-table">
                <tr><th>From</th><th>To</th><th>When</th></tr>
                <tr><td>active</td><td>expired</td><td>Past expiry date + 3 day grace period</td></tr>
                <tr><td>active</td><td>cancelled</td><td>User cancels subscription</td></tr>
            </table>

            <h2 class="docs-h2">DB Health Check (--fix Behavior)</h2>
            <p class="docs-p">
                The <code class="docs-code">db_health.py --fix</code> command performs three actions:
            </p>
            <ul class="docs-list">
                <li><strong>Deletes invalid candles:</strong> high &lt; low, price â‰¤ 0, misaligned timestamps</li>
                <li><strong>Fetches missing candles:</strong> Tries to fetch gaps from Binance</li>
                <li><strong>Re-aggregates:</strong> Rebuilds higher timeframes after filling gaps</li>
            </ul>
            <p class="docs-p">
                If the exchange has no data for a gap (legitimate), it's marked as a <strong>"known gap"</strong>
                and skipped on future runs. Use <code class="docs-code">--show-gaps</code> to view all known gaps.
            </p>
            <p class="docs-p">
                Valid historical data is never deleted, even if old.
            </p>

            <h2 class="docs-h2">Manual Data Cleanup</h2>
            <p class="docs-p">
                If you need to clean up data manually (e.g., reduce database size), use SQL directly:
            </p>
            <div class="docs-codeblock">-- Example: Delete candles older than 90 days (CAUTION!)
DELETE FROM candles
WHERE timestamp < (strftime('%s', 'now') - 90*24*60*60) * 1000;

-- Example: Delete expired patterns older than 60 days
DELETE FROM patterns
WHERE status = 'expired'
AND detected_at < (strftime('%s', 'now') - 60*24*60*60) * 1000;</div>

            <div class="docs-alert docs-alert-warning">
                <strong>Caution:</strong> Always backup before manual deletions. Historical data cannot be recovered once deleted.
            </div>
        </section>

        <!-- ==================== TESTING ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'testing' }">
            <h1 class="docs-h1">Testing</h1>

            <p class="docs-p">
                CryptoLens has a comprehensive test suite with 607+ tests covering all major functionality.
                Tests use pytest with fixtures for database and application context.
            </p>

            <h2 class="docs-h2">Test Statistics</h2>
            <table class="docs-table">
                <tr><th>Metric</th><th>Value</th></tr>
                <tr><td>Total Tests</td><td><span class="docs-badge docs-badge-green">607</span></td></tr>
                <tr><td>Test Files</td><td>20 files</td></tr>
                <tr><td>Average Run Time</td><td>~100 seconds</td></tr>
                <tr><td>Framework</td><td>pytest</td></tr>
            </table>

            <h2 class="docs-h2">Test Files</h2>
            <table class="docs-table">
                <tr><th>File</th><th>Coverage Area</th><th>Tests</th></tr>
                <tr><td><code class="docs-code">test_auth.py</code></td><td>Login, register, 2FA, password reset</td><td>Authentication flows</td></tr>
                <tr><td><code class="docs-code">test_api.py</code></td><td>REST API endpoints</td><td>All API routes</td></tr>
                <tr><td><code class="docs-code">test_routes.py</code></td><td>Web routes, page loads</td><td>Frontend routes</td></tr>
                <tr><td><code class="docs-code">test_tiers.py</code></td><td>Subscription tier access</td><td>Feature restrictions</td></tr>
                <tr><td><code class="docs-code">test_tier_access.py</code></td><td>Tier-based permissions</td><td>Access control</td></tr>
                <tr><td><code class="docs-code">test_access.py</code></td><td>General access control</td><td>Auth decorators</td></tr>
                <tr><td><code class="docs-code">test_pattern_scanning.py</code></td><td>Pattern detection</td><td>FVG, OB, Sweep detectors</td></tr>
                <tr><td><code class="docs-code">test_signals.py</code></td><td>Signal generation</td><td>Confluence calculation</td></tr>
                <tr><td><code class="docs-code">test_notifier.py</code></td><td>Push notifications</td><td>NTFY integration</td></tr>
                <tr><td><code class="docs-code">test_async_notifier.py</code></td><td>Async notifications</td><td>Connection pooling</td></tr>
                <tr><td><code class="docs-code">test_payments.py</code></td><td>Payment processing</td><td>LemonSqueezy, NOWPayments</td></tr>
                <tr><td><code class="docs-code">test_subscription.py</code></td><td>Subscription management</td><td>Upgrades, expiry</td></tr>
                <tr><td><code class="docs-code">test_backtester.py</code></td><td>Backtesting engine</td><td>Strategy simulation</td></tr>
                <tr><td><code class="docs-code">test_services.py</code></td><td>Service layer</td><td>Business logic</td></tr>
                <tr><td><code class="docs-code">test_jobs.py</code></td><td>Background jobs</td><td>Maintenance tasks</td></tr>
                <tr><td><code class="docs-code">test_db_health.py</code></td><td>Data integrity</td><td>Health checks</td></tr>
                <tr><td><code class="docs-code">test_security.py</code></td><td>Security features</td><td>CSRF, rate limiting</td></tr>
                <tr><td><code class="docs-code">test_observability.py</code></td><td>Monitoring</td><td>Metrics, health checks</td></tr>
                <tr><td><code class="docs-code">test_admin_notifications.py</code></td><td>Admin features</td><td>Broadcasts, templates</td></tr>
                <tr><td><code class="docs-code">test_integration.py</code></td><td>End-to-end flows</td><td>Full user journeys</td></tr>
            </table>

            <h2 class="docs-h2">Running Tests</h2>
            <div class="docs-codeblock"># Run all tests
python -m pytest tests/

# Run with verbose output
python -m pytest tests/ -v

# Run specific test file
python -m pytest tests/test_auth.py

# Run specific test class
python -m pytest tests/test_auth.py::TestLogin

# Run specific test
python -m pytest tests/test_auth.py::TestLogin::test_login_success

# Run with coverage report
python -m pytest tests/ --cov=app --cov-report=html

# Run tests quickly (stop on first failure)
python -m pytest tests/ -x

# Run tests in parallel (requires pytest-xdist)
python -m pytest tests/ -n auto</div>

            <h2 class="docs-h2">Test Fixtures</h2>
            <p class="docs-p">Common fixtures defined in <code class="docs-code">conftest.py</code>:</p>
            <table class="docs-table">
                <tr><th>Fixture</th><th>Scope</th><th>Purpose</th></tr>
                <tr><td><code class="docs-code">app</code></td><td>function</td><td>Flask application with test config</td></tr>
                <tr><td><code class="docs-code">client</code></td><td>function</td><td>Test client for HTTP requests</td></tr>
                <tr><td><code class="docs-code">db</code></td><td>function</td><td>Database session (in-memory SQLite)</td></tr>
                <tr><td><code class="docs-code">user</code></td><td>function</td><td>Test user (free tier)</td></tr>
                <tr><td><code class="docs-code">admin_user</code></td><td>function</td><td>Test admin user</td></tr>
                <tr><td><code class="docs-code">pro_user</code></td><td>function</td><td>Test pro tier user</td></tr>
                <tr><td><code class="docs-code">premium_user</code></td><td>function</td><td>Test premium tier user</td></tr>
                <tr><td><code class="docs-code">symbol</code></td><td>function</td><td>Test symbol (BTC/USDT)</td></tr>
                <tr><td><code class="docs-code">candles</code></td><td>function</td><td>Sample candle data</td></tr>
            </table>

            <h2 class="docs-h2">Test Categories</h2>

            <h3 class="docs-h3">Backend Tests</h3>
            <ul class="docs-list">
                <li><strong>Unit Tests</strong> - Test individual functions and methods</li>
                <li><strong>Service Tests</strong> - Test business logic in services</li>
                <li><strong>Model Tests</strong> - Test SQLAlchemy models and relationships</li>
                <li><strong>API Tests</strong> - Test REST API endpoints</li>
            </ul>

            <h3 class="docs-h3">Frontend Tests</h3>
            <ul class="docs-list">
                <li><strong>Route Tests</strong> - Test page loads and redirects</li>
                <li><strong>Form Tests</strong> - Test form submissions and validation</li>
                <li><strong>Access Tests</strong> - Test tier-based access control</li>
            </ul>

            <h3 class="docs-h3">Integration Tests</h3>
            <ul class="docs-list">
                <li><strong>User Flows</strong> - Complete registration to trading flow</li>
                <li><strong>Payment Flows</strong> - Checkout to subscription activation</li>
                <li><strong>Notification Flows</strong> - Pattern detection to push notification</li>
            </ul>

            <h2 class="docs-h2">Coverage Report</h2>
            <p class="docs-p">Generate HTML coverage report:</p>
            <div class="docs-codeblock">python -m pytest tests/ --cov=app --cov-report=html
# Open htmlcov/index.html in browser</div>

            <div class="docs-alert docs-alert-info">
                <strong>CI/CD:</strong> Tests run automatically on every push. All tests must pass before merging.
            </div>
        </section>

        <!-- ==================== ADMIN ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'admin' }">
            <h1 class="docs-h1">Admin Panel</h1>

            <h2 class="docs-h2">Quick Actions</h2>
            <p class="docs-p">The Admin panel features a Quick Actions bar at the top for common operations:</p>
            <table class="docs-table">
                <tr><th>Action</th><th>Color</th><th>Description</th></tr>
                <tr><td><strong>Scan Now</strong></td><td><span class="docs-badge docs-badge-green">Green</span></td><td>Trigger a manual pattern scan across all symbols</td></tr>
                <tr><td><strong>Refresh Stats</strong></td><td><span class="docs-badge docs-badge-blue">Blue</span></td><td>Recompute cached statistics for fast page loads</td></tr>
                <tr><td><strong>Cleanup</strong></td><td><span class="docs-badge docs-badge-orange">Orange</span></td><td>Run database health check and fix data issues</td></tr>
            </table>

            <h2 class="docs-h2">Navigation Groups</h2>
            <p class="docs-p">The Admin panel organizes links into logical groups:</p>

            <h3 class="docs-h3">Users</h3>
            <ul class="docs-list">
                <li><strong>Users</strong> - View and manage all users</li>
                <li><strong>Create User</strong> - Create new user accounts</li>
                <li><strong>Subscriptions</strong> - Manage subscription status</li>
            </ul>

            <h3 class="docs-h3">System</h3>
            <ul class="docs-list">
                <li><strong>Cron Jobs</strong> - Monitor background job status and history</li>
                <li><strong>Error Logs</strong> - View and manage application errors</li>
                <li><strong>Settings</strong> - System-wide configuration</li>
            </ul>

            <h3 class="docs-h3">Communications</h3>
            <ul class="docs-list">
                <li><strong>Notifications</strong> - View notification history and test</li>
                <li><strong>Templates</strong> - Manage notification templates</li>
                <li><strong>Schedule Broadcast</strong> - Schedule notifications for future delivery</li>
            </ul>

            <h3 class="docs-h3">Reference</h3>
            <ul class="docs-list">
                <li><strong>Documentation</strong> - This documentation page</li>
                <li><strong>API Docs</strong> - Swagger UI for API reference</li>
            </ul>

            <h2 class="docs-h2">User Management Actions</h2>
            <table class="docs-table">
                <tr><th>Action</th><th>Description</th></tr>
                <tr><td>Verify Email</td><td>Manually verify user's email</td></tr>
                <tr><td>Deactivate</td><td>Disable user account (soft delete)</td></tr>
                <tr><td>Activate</td><td>Re-enable deactivated account</td></tr>
                <tr><td>Grant Admin</td><td>Give admin privileges</td></tr>
                <tr><td>Revoke Admin</td><td>Remove admin privileges</td></tr>
                <tr><td>Extend Subscription</td><td>Add days to subscription</td></tr>
                <tr><td>Change Tier</td><td>Upgrade/downgrade subscription plan</td></tr>
            </table>

            <h2 class="docs-h2">"View As" Mode</h2>
            <p class="docs-p">
                Temporarily view the application as a specific user tier to test feature restrictions.
                This does not affect your actual admin privileges. Available tiers: Admin (Full Access), Premium, Pro, Free.
            </p>
        </section>

        <!-- ==================== SECURITY ==================== -->
        <section class="docs-section" :class="{ active: activeSection === 'security' }">
            <h1 class="docs-h1">Security</h1>

            <h2 class="docs-h2">Authentication Security</h2>
            <ul class="docs-list">
                <li><strong>Password Hashing</strong> - Werkzeug PBKDF2-SHA256</li>
                <li><strong>2FA Support</strong> - TOTP-based two-factor authentication</li>
                <li><strong>Rate Limiting</strong> - Prevents brute force attacks</li>
                <li><strong>Account Lockout</strong> - After 5 failed login attempts</li>
                <li><strong>Session Security</strong> - Secure, HTTP-only cookies</li>
            </ul>

            <h2 class="docs-h2">CSRF Protection</h2>
            <p class="docs-p">
                All forms include CSRF tokens via Flask-WTF. API endpoints are exempt but require API key authentication.
            </p>

            <h2 class="docs-h2">API Security</h2>
            <ul class="docs-list">
                <li><strong>API Keys</strong> - SHA-256 hashed, timing-safe comparison</li>
                <li><strong>Rate Limiting</strong> - Per-endpoint limits</li>
                <li><strong>Tier Restrictions</strong> - Premium-only API access</li>
            </ul>

            <h2 class="docs-h2">Payment Security</h2>
            <ul class="docs-list">
                <li><strong>Webhook Verification</strong> - HMAC signature validation</li>
                <li><strong>No Card Storage</strong> - All payment data handled by providers</li>
                <li><strong>PCI Compliant</strong> - Via LemonSqueezy integration</li>
            </ul>

            <div class="docs-alert docs-alert-warning">
                <strong>Security Reminder:</strong> Change default admin password immediately after setup.
                Never commit .env files or API keys to version control.
            </div>
        </section>

    </main>
</div>
{% endblock %}
