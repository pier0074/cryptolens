{% extends "base.html" %}

{% block title %}Payment History - CryptoLens{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold">Payment History</h1>
        <a href="{{ url_for('payments.upgrade') }}"
           class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition">
            Upgrade Plan
        </a>
    </div>

    {% if payments %}
    <div class="bg-card rounded-xl overflow-hidden">
        <table class="w-full">
            <thead class="bg-darker">
                <tr>
                    <th class="px-6 py-4 text-left text-sm font-medium text-gray-400">Date</th>
                    <th class="px-6 py-4 text-left text-sm font-medium text-gray-400">Plan</th>
                    <th class="px-6 py-4 text-left text-sm font-medium text-gray-400">Amount</th>
                    <th class="px-6 py-4 text-left text-sm font-medium text-gray-400">Provider</th>
                    <th class="px-6 py-4 text-left text-sm font-medium text-gray-400">Status</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-gray-700">
                {% for payment in payments %}
                <tr class="hover:bg-darker/50">
                    <td class="px-6 py-4 text-sm">
                        {{ payment.created_at.strftime('%Y-%m-%d %H:%M') if payment.created_at else 'N/A' }}
                    </td>
                    <td class="px-6 py-4">
                        <span class="font-medium">{{ payment.plan.title() }}</span>
                        <span class="text-gray-400 text-sm">({{ payment.billing_cycle }})</span>
                    </td>
                    <td class="px-6 py-4">
                        ${{ '%.2f'|format(payment.amount) }} {{ payment.currency }}
                        {% if payment.crypto_currency %}
                        <span class="text-gray-400 text-sm block">{{ payment.crypto_amount or '?' }} {{ payment.crypto_currency }}</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4 text-sm">
                        {% if payment.provider == 'lemonsqueezy' %}
                        <span class="text-yellow-400">Card</span>
                        {% else %}
                        <span class="text-blue-400">Crypto</span>
                        {% endif %}
                    </td>
                    <td class="px-6 py-4">
                        {% if payment.status == 'completed' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-900 text-green-200">
                            Completed
                        </span>
                        {% elif payment.status == 'pending' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-900 text-yellow-200">
                            Pending
                        </span>
                        {% elif payment.status == 'expired' %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-700 text-gray-300">
                            Expired
                        </span>
                        {% else %}
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-900 text-red-200">
                            {{ payment.status.title() }}
                        </span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="bg-card rounded-xl p-12 text-center">
        <svg class="w-16 h-16 text-gray-600 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
        </svg>
        <h3 class="text-xl font-medium text-gray-400 mb-2">No payments yet</h3>
        <p class="text-gray-500 mb-6">Upgrade your plan to access premium features</p>
        <a href="{{ url_for('payments.upgrade') }}"
           class="inline-block bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition">
            View Plans
        </a>
    </div>
    {% endif %}

    <div class="mt-8 text-center">
        <a href="{{ url_for('auth.profile') }}" class="text-gray-400 hover:text-gray-300">
            Back to Profile
        </a>
    </div>
</div>
{% endblock %}
